"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[33],{6327:(e,t,i)=>{i.d(t,{l:()=>h});var n=i(1539),s=i(6987),a=i(70),l=i(9067),r=i(4669),o=i(9484);class h extends n.W{constructor(){super(...arguments),this._planeSize=null}withPlaneSize(e){return this._planeSize=e,this}make(){return this.gameObjectBuilder.withComponent(s.N,(e=>{e.offset=-100})).withComponent(a.n,(e=>{e.chunkSize=15,e.filter.brightness=1.5,e.tileResolutionX=16,e.tileResolutionY=16,l.E.loadImageFromPath(o.Z).then((t=>{var i,n;if(!e.exists)return;e.imageSources=[new r.I(t,18,13)];const s={i:0,a:24},a=null!=(i=null==(n=this._planeSize)?void 0:n.ref)?i:51,l=[];for(let e=0;e<a;e++){l[e]=[];for(let t=0;t<a;t++)l[e][t]=s}const o=Math.floor(a/2);e.drawTileFromTwoDimensionalArray(l,-o,-o)}))}))}}},3290:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>T,contentTitle:()=>v,default:()=>O,frontMatter:()=>C,metadata:()=>S,toc:()=>N});var n=i(7462),s=(i(7294),i(3905)),a=i(7346),l=i(3274),r=i(70),o=i(9067),h=i(4669),m=i(2684),c=i(2182),d=i(5355),u=i(4587),p=i(4532),g=i(9484),w=i(6327);class k extends l.A{run(){const e=this.instantiater;return this.sceneBuilder.withChild(e.buildGameObject("background",new p.P(0,0,-1)).withComponent(r.n,(e=>{e.chunkSize=15,e.tileResolutionX=16,e.tileResolutionY=16,o.E.loadImageFromPath(g.Z).then((t=>{e.exists&&(e.imageSources=[new h.I(t,18,13)],e.drawTile(0,0,0,24))}))}))).withChild(e.buildGameObject("camera").withComponent(m.V,(e=>{e.viewSize=4})).withComponent(c.Y,(e=>{e.mouseMoveButton=0,e.maxViewSize=4})).withComponent(d.y,(e=>{e.renderWidth=50,e.renderHeight=50})))}}class f extends l.A{run(){const e=this.instantiater;return this.sceneBuilder.withChild(e.buildGameObject("background",new p.P(0,0,-1)).withComponent(r.n,(e=>{e.chunkSize=15,e.tileResolutionX=16,e.tileResolutionY=16,o.E.loadImageFromPath(g.Z).then((t=>{e.exists&&(e.imageSources=[new h.I(t,18,13)],e.drawTileFromTwoDimensionalArray(u.d.map(["gggg","gggg","gggg","gggg"],{g:()=>({i:0,a:24})}),0,0))}))}))).withChild(e.buildGameObject("camera").withComponent(m.V,(e=>{e.viewSize=4})).withComponent(c.Y,(e=>{e.mouseMoveButton=0,e.maxViewSize=4})).withComponent(d.y,(e=>{e.renderWidth=50,e.renderHeight=50})))}}class b extends l.A{run(){const e=this.instantiater;return this.sceneBuilder.withChild(e.buildGameObject("background",new p.P(0,0,-1)).withComponent(r.n,(e=>{e.chunkSize=15,e.tileResolutionX=16,e.tileResolutionY=16,o.E.loadImageFromPath(g.Z).then((t=>{if(!e.exists)return;e.imageSources=[new h.I(t,18,13)];const i={i:0,a:24},n=[];for(let e=0;e<51;e++){n[e]=[];for(let t=0;t<51;t++)n[e][t]=i}const s=Math.floor(25.5);e.drawTileFromTwoDimensionalArray(n,-s,-s)}))}))).withChild(e.buildGameObject("camera").withComponent(m.V,(e=>{e.viewSize=4})).withComponent(c.Y,(e=>{e.mouseMoveButton=0,e.maxViewSize=4})).withComponent(d.y,(e=>{e.renderWidth=50,e.renderHeight=50})))}}class y extends l.A{run(){const e=this.instantiater;return this.sceneBuilder.withChild(e.buildPrefab("background",w.l,new p.P(0,0,-1)).make()).withChild(e.buildGameObject("camera").withComponent(m.V,(e=>{e.viewSize=4})).withComponent(c.Y,(e=>{e.mouseMoveButton=0,e.maxViewSize=4})).withComponent(d.y,(e=>{e.renderWidth=50,e.renderHeight=50})))}}const C={},v="Tilemap Basic",S={unversionedId:"tutorial-2dtopdown/tilemap-basic",id:"tutorial-2dtopdown/tilemap-basic",title:"Tilemap Basic",description:"Let's find out the basic way to use the built-in engine component tilemap",source:"@site/docs/2-tutorial-2dtopdown/4-tilemap-basic.mdx",sourceDirName:"2-tutorial-2dtopdown",slug:"/tutorial-2dtopdown/tilemap-basic",permalink:"/the-world-engine.ts/build/docs/tutorial-2dtopdown/tilemap-basic",draft:!1,editUrl:"https://github.com/The-World-Space/the-world-engine.ts/tree/main/docs/docusaurus/docs/2-tutorial-2dtopdown/4-tilemap-basic.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Sprite Atlas Setup",permalink:"/the-world-engine.ts/build/docs/tutorial-2dtopdown/sprite-atlas-setup"},next:{title:"Make Tilemap Layer",permalink:"/the-world-engine.ts/build/docs/tutorial-2dtopdown/make-tilemap-layer"}},T={},N=[{value:"Kind of Tilemap",id:"kind-of-tilemap",level:2},{value:"Usage of <code>CssTilemapChunkRenderer</code>",id:"usage-of-csstilemapchunkrenderer",level:2},{value:"Draw Tile From Two Dimensional Array",id:"draw-tile-from-two-dimensional-array",level:2},{value:"Mapping from String Array",id:"mapping-from-string-array",level:3},{value:"Make Grass Background",id:"make-grass-background",level:2}],x={toc:N};function O(e){let{components:t,...i}=e;return(0,s.kt)("wrapper",(0,n.Z)({},x,i,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"tilemap-basic"},"Tilemap Basic"),(0,s.kt)("p",null,"Let's find out the basic way to use the built-in engine component tilemap"),(0,s.kt)("h2",{id:"kind-of-tilemap"},"Kind of Tilemap"),(0,s.kt)("p",null,"Currently, four types of tile maps are provided as standard:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"CssTilemapRenderer")," - It's the most basic form of tilemap. You are ",(0,s.kt)("strong",{parentName:"li"},"limited in size")," and can draw tiles from a given tile set."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"CssTilemapChunkRenderer")," - As a wrapper of the ",(0,s.kt)("inlineCode",{parentName:"li"},"CssTilemapRenderer"),", it is a tilemap of ",(0,s.kt)("strong",{parentName:"li"},"infinite size"),"."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"CssCollideTilemapRenderer")," - It is a tilemap that ",(0,s.kt)("strong",{parentName:"li"},"contains a grid collide map"),"."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"CssCollideTilemapChunkRenderer")," - As a wrapper of the ",(0,s.kt)("inlineCode",{parentName:"li"},"CssCollideTilemapRenderer"),", it has ",(0,s.kt)("strong",{parentName:"li"},"infinite size"),".")),(0,s.kt)("admonition",{type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"grid collide maps are used for collision handling in grid-based games. We'll talk about this later.")),(0,s.kt)("h2",{id:"usage-of-csstilemapchunkrenderer"},"Usage of ",(0,s.kt)("inlineCode",{parentName:"h2"},"CssTilemapChunkRenderer")),(0,s.kt)("p",null,"First, let's use the CssTilemapChunkRender to draw background tiles."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},'return this.sceneBuilder\n    .withChild(instantiater.buildGameObject("background", new Vector3(0, 0, -1))\n        .withComponent(CssTilemapChunkRenderer, c => {\n            c.chunkSize = 15;\n            c.tileResolutionX = 16;\n            c.tileResolutionY = 16;\n\n            AsyncImageLoader.loadImageFromPath(OverworldTileset).then(image => {\n                if (!c.exists) return;\n\n                c.imageSources = [ new TileAtlasItem(image, 18, 13) ];\n                c.drawTile(0, 0, 0, 24);\n            });\n        }))\n\n    .withChild(instantiater.buildGameObject("camera")\n        .withComponent(Camera, c => {\n            c.viewSize = 4;\n        })\n        .withComponent(EditorCameraController, c => {\n            c.mouseMoveButton = 0;\n        })\n        .withComponent(EditorGridRenderer, c => {\n            c.renderWidth = 50;\n            c.renderHeight = 50;\n        }))\n;\n')),(0,s.kt)(a.Z,{bootstrapper:k,ignoreEvents:!0,mdxType:"DocumentGame"}),(0,s.kt)("p",null,"Let's look at the code line by line."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"c.chunkSize = 15;\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"First, I'm specifying the chunk size.\nThis is because if the chunk size is even,\nthe center of the tilemap coordinate system is (0.5, 0.5) and if it's odd,\nit's (0, 0), so we put an odd value in order to make the coordinate system (0, 0).\nThe default chunk size is 16, which is odd.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"c.tileResolutionX = 16;\nc.tileResolutionY = 16;\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Next, the tileResolution value is specified.\nIt is recommended that the resolution of the tile map renderer be\naccurate to the resolution of the tile. In this case, the resolution of the tile is 16x16,\nso we set it to 16.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"AsyncImageLoader.loadImageFromPath(OverworldTileset).then(image => {\n    if (!c.exists) return;\n\n    //...\n});\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"then loading the image using AsyncImageLoader.\nAsyncImageLoader is just a Promise Wrapper for an onLoad callback.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"c.exists is the code to determine if a component exists,\nand it is recommended that you check the existence for all asynchronous job callbacks\nbecause the component may have been destroyed by another element after the asynchronous operation.\n",(0,s.kt)("em",{parentName:"p"},"(For example, the most frequent problem is that if the player unmounts the game while loading the game, the component will no longer exist at the time of asynchronous callback.)")))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"c.imageSources = [ new TileAtlasItem(image, 18, 13) ];\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Then you have to specify the sprite Atlas to use in Renderer.\n18 and 13 are column count and row count")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"c.drawTile(0, 0, 0, 24);\n")),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Finally, you can draw a tile.\nThe first two numbers are x, y values to draw tiles,\nfollowed by the index of the c.imageSources array,\nand the last is the index value of the sprite Atlas.\nOverworld Tileset's 24th tile is a grass tile.")),(0,s.kt)("h2",{id:"draw-tile-from-two-dimensional-array"},"Draw Tile From Two Dimensional Array"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},"const g = { i: 0 as const, a: 24 };\n    \nc.drawTileFromTwoDimensionalArray(\n    [\n        [g, g, g, g],\n        [g, g, g, g],\n        [g, g, g, g],\n        [g, g, g, g]\n    ],\n    0, 0\n);\n")),(0,s.kt)(a.Z,{bootstrapper:f,ignoreEvents:!0,mdxType:"DocumentGame"}),(0,s.kt)("p",null,"You can also draw tiles through a two-dimensional array."),(0,s.kt)("p",null,"The items in the array type is ",(0,s.kt)("inlineCode",{parentName:"p"},"{ i: number, a: number }"),".\nwhere i stands for the index of c.imageSources and a stands for the index of Sprite Atlas."),(0,s.kt)("p",null,"The last parameter 0, 0 is the center coordinate to draw the tile.\nThe center coordinates span the left corner of the two-dimensional array"),(0,s.kt)("h3",{id:"mapping-from-string-array"},"Mapping from String Array"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},'c.drawTileFromTwoDimensionalArray(\n    TwoDimensionalStringMapper.map([\n        "gggg",\n        "gggg",\n        "gggg",\n        "gggg"\n    ], {\n        "g": () => ({ i: 0, a: 24 }),\n    }),\n    0, 0\n);\n')),(0,s.kt)("p",null,"Code for obtaining the same result as above.\nIt can be viewed in a more readable form by mapping through strings."),(0,s.kt)("p",null,"In future tutorials, we will use string mapping to design levels."),(0,s.kt)("h2",{id:"make-grass-background"},"Make Grass Background"),(0,s.kt)("p",null,"Now let's make a lawn."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},'.withChild(instantiater.buildGameObject("background", new Vector3(0, 0, -1))\n    .withComponent(CssTilemapChunkRenderer, c => {\n        c.chunkSize = 15;\n        c.tileResolutionX = 16;\n        c.tileResolutionY = 16;\n\n        AsyncImageLoader.loadImageFromPath(OverworldTileset).then(image => {\n            if (!c.exists) return;\n\n            c.imageSources = [ new TileAtlasItem(image, 18, 13) ];\n\n            const grass = { i: 0 as const, a: 24 };\n            const planeSize = 51;\n\n            const array2d: { i: 0; a: number; }[][] = [];\n            for (let i = 0; i < planeSize; i++) {\n                array2d[i] = [];\n                for (let j = 0; j < planeSize; j++) {\n                    array2d[i][j] = grass;\n                }\n            }\n\n            const planeSizeHalf = Math.floor(planeSize / 2);\n\n            c.drawTileFromTwoDimensionalArray(\n                array2d,\n                -planeSizeHalf, -planeSizeHalf\n            );\n        });\n    }))\n')),(0,s.kt)("p",null,"We'll use a loop because it's a simple iteration."),(0,s.kt)(a.Z,{bootstrapper:b,ignoreEvents:!0,mdxType:"DocumentGame"}),(0,s.kt)("p",null,"There is a lawn, but I think it's too dark. In fact, the asset we use is a little dark in color."),(0,s.kt)("p",null,"Let's use the css filter to make it brighter."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},".withComponent(CssTilemapChunkRenderer, c => {\n    c.filter.brightness = 1.5;\n    //...\n})\n")),(0,s.kt)(a.Z,{bootstrapper:y,ignoreEvents:!0,mdxType:"DocumentGame"}),(0,s.kt)("p",null,"I think it's better now"))}O.isMDXComponent=!0},5355:(e,t,i)=>{i.d(t,{y:()=>o});var n=i(4532),s=i(8172),a=i(9384),l=i(2684),r=i(2138);class o extends s.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[l.V],this.Nn=null,this.zn=null,this.Th=1,this.Ph=1,this.kn=18,this.Bn=10,this.qn=.2,this.An=0,this.Jn=new n.P(NaN,NaN,NaN)}awake(){const e=new a.s;this.zn=this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildGameObject("grid-renderer",void 0,void 0,new n.P(this.qn,this.qn,this.qn)).active(!1).withComponent(r.w,(e=>{const t=document.createElement("div");t.style.backgroundImage="                        repeating-linear-gradient(#999 0 1px, transparent 1px 100%),                        repeating-linear-gradient(90deg, #999 0 1px, transparent 1px 100%)",t.style.backgroundSize=this.Th/this.qn/.1+"px "+this.Ph/this.qn/.1+"px",e.elementWidth=this.kn/this.qn,e.elementHeight=this.Bn/this.qn,e.pointerEvents=!1,e.element=t,e.viewScale=.1})).getComponent(r.w,e)),this.Nn=e.ref}onEnable(){this.zn.exists&&(this.zn.activeSelf=!0)}onDisable(){this.zn.exists&&(this.zn.activeSelf=!1)}update(){const e=this.transform.position,t=1/this.qn/.1,i=this.kn*t/2,n=this.Bn*t/2,s=this.Th*t,a=this.Ph*t,l=i%s,r=n%a;if(!e.equals(this.Jn)){const i=this.zn.transform.position;i.copy(e),i.z+=this.An,this.Nn.element.style.backgroundPosition=-e.x*t+l+s/2-.5+"px "+(e.y*t+r+a/2-.5)+"px"}}onDestroy(){var e;null===(e=this.zn)||void 0===e||e.destroy()}Qn(){const e=this.Nn;e&&(e.element.style.backgroundSize=this.Th/this.qn/.1+"px "+this.Ph/this.qn/.1+"px")}get gridCellWidth(){return this.Th}set gridCellWidth(e){this.Th=e,this.Qn()}get gridCellHeight(){return this.Ph}set gridCellHeight(e){this.Ph=e,this.Qn()}get renderWidth(){return this.kn}set renderWidth(e){this.kn=e,this.Nn&&(this.Nn.elementWidth=this.kn/this.qn)}get renderHeight(){return this.Bn}set renderHeight(e){this.Bn=e,this.Nn&&(this.Nn.elementHeight=this.Bn/this.qn)}get lineWidth(){return.1*this.qn}set lineWidth(e){this.qn=e/.1;const t=this.Nn;t&&(this.Qn(),t.elementWidth=this.kn/this.qn,t.elementHeight=this.Bn/this.qn,t.gameObject.transform.localScale.setScalar(this.qn))}get zOffset(){return this.An}set zOffset(e){this.An=e}}},2138:(e,t,i)=>{i.d(t,{w:()=>a});var n=i(9387),s=i(9429);class a extends s.Y{constructor(){super(...arguments),this.tu=1,this.su=1,this.iu=!1,this.Za=null}renderInitialize(){var e;null===(e=this.Za)||void 0===e||e.call(this),this.htmlElement||(this.element=null)}updateCenterOffset(e){if(!this.css3DObject)return;let t,i;if(this.iu)if(this.css3DObject.element.parentElement){const e=this.css3DObject.element.style.display;this.css3DObject.element.style.display="",t=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=e}else{const e=this.css3DObject.element.style.display;this.css3DObject.element.style.display="";const n=this.css3DObject.element.style.transform;this.css3DObject.element.style.transform="translateX(1000000px)",document.body.appendChild(this.css3DObject.element),t=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=e,this.css3DObject.element.style.transform=n,document.body.removeChild(this.css3DObject.element)}else t=this.tu,i=this.su;this.css3DObject.position.set(t*this.centerOffset.x,i*this.centerOffset.y,0),e&&(n.w.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(e){if(!this.css3DObject)return;const t=this.viewScale;this.iu?(this.css3DObject.scale.set(t,t,t),this.updateCenterOffset(!1)):(this.css3DObject.element.style.width=this.tu/this.viewScale+"px",this.css3DObject.element.style.height=this.su/this.viewScale+"px",this.css3DObject.scale.set(t,t,t)),e&&(n.w.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get element(){return this.htmlElement}set element(e){const t=this.htmlElement=null!=e?e:document.createElement("div");this.readyToDraw?this.hu(t):this.Za=()=>this.hu(t)}hu(e){this.iu?(e.style.width="auto",e.style.height="auto"):(e.style.width=this.tu/this.viewScale+"px",e.style.height=this.su/this.viewScale+"px");const t=this.initializeBaseComponents(!0);n.w.updateRawObject3DWorldMatrixRecursively(t),this.transform.enqueueRenderAttachedObject3D(t)}get elementWidth(){if(this.iu){if(this.htmlElement){const e=this.htmlElement.style.display;this.htmlElement.style.display="";const t=this.htmlElement.offsetWidth*this.viewScale;return this.htmlElement.style.display=e,t}return 0}return this.tu}set elementWidth(e){this.iu||(this.tu=e,this.htmlElement&&(this.htmlElement.style.width=e/this.viewScale+"px"),this.updateCenterOffset(!0))}get elementHeight(){if(this.iu){if(this.htmlElement){const e=this.htmlElement.style.display;this.htmlElement.style.display="";const t=this.htmlElement.offsetHeight*this.viewScale;return this.htmlElement.style.display=e,t}return 0}return this.su}set elementHeight(e){this.iu||(this.su=e,this.htmlElement&&(this.htmlElement.style.height=e/this.viewScale+"px"),this.updateCenterOffset(!0))}get autoSize(){return this.iu}set autoSize(e){this.iu=e,this.htmlElement&&(e?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tu/this.viewScale+"px",this.htmlElement.style.height=this.su/this.viewScale+"px"))}}},9484:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/Overworld_Tileset-1c44075b314e79caada3455aa25f5809.png"}}]);