"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[33],{6327:(t,e,i)=>{i.d(e,{l:()=>o});var s=i(546),n=i(251),r=i(7111),h=i(983),a=i(6868),l=i(9484);class o extends s.W{constructor(){super(...arguments),this._planeSize=null}withPlaneSize(t){return this._planeSize=t,this}make(){return this.gameObjectBuilder.withComponent(n.N,(t=>{t.offset=-100})).withComponent(r.n,(t=>{t.chunkSize=15,t.filter.brightness=1.5,t.tileResolutionX=16,t.tileResolutionY=16,h.E.loadImageFromPath(l.Z).then((e=>{var i,s;if(!t.exists)return;t.imageSources=[new a.I(e,18,13)];const n={i:0,a:24},r=null!=(i=null==(s=this._planeSize)?void 0:s.ref)?i:51,h=[];for(let t=0;t<r;t++){h[t]=[];for(let e=0;e<r;e++)h[t][e]=n}const l=Math.floor(r/2);t.drawTileFromTwoDimensionalArray(h,-l,-l)}))}))}}},3290:(t,e,i)=>{i.r(e),i.d(e,{assets:()=>x,contentTitle:()=>S,default:()=>T,frontMatter:()=>k,metadata:()=>v,toc:()=>E});var s=i(7462),n=(i(7294),i(3905)),r=i(9017),h=i(708),a=i(7111),l=i(983),o=i(6868),d=i(6896),c=i(1269),m=i(6885),u=i(291),p=i(4532),g=i(9484),w=i(6327);class f extends h.A{run(){const t=this.instantiater;return this.sceneBuilder.withChild(t.buildGameObject("background",new p.P(0,0,-1)).withComponent(a.n,(t=>{t.chunkSize=15,t.tileResolutionX=16,t.tileResolutionY=16,l.E.loadImageFromPath(g.Z).then((e=>{t.exists&&(t.imageSources=[new o.I(e,18,13)],t.drawTile(0,0,0,24))}))}))).withChild(t.buildGameObject("camera").withComponent(d.V,(t=>{t.viewSize=4})).withComponent(c.Y,(t=>{t.mouseMoveButton=0,t.maxViewSize=4})).withComponent(m.y,(t=>{t.renderWidth=50,t.renderHeight=50})))}}class y extends h.A{run(){const t=this.instantiater;return this.sceneBuilder.withChild(t.buildGameObject("background",new p.P(0,0,-1)).withComponent(a.n,(t=>{t.chunkSize=15,t.tileResolutionX=16,t.tileResolutionY=16,l.E.loadImageFromPath(g.Z).then((e=>{t.exists&&(t.imageSources=[new o.I(e,18,13)],t.drawTileFromTwoDimensionalArray(u.d.map(["gggg","gggg","gggg","gggg"],{g:()=>({i:0,a:24})}),0,0))}))}))).withChild(t.buildGameObject("camera").withComponent(d.V,(t=>{t.viewSize=4})).withComponent(c.Y,(t=>{t.mouseMoveButton=0,t.maxViewSize=4})).withComponent(m.y,(t=>{t.renderWidth=50,t.renderHeight=50})))}}class b extends h.A{run(){const t=this.instantiater;return this.sceneBuilder.withChild(t.buildGameObject("background",new p.P(0,0,-1)).withComponent(a.n,(t=>{t.chunkSize=15,t.tileResolutionX=16,t.tileResolutionY=16,l.E.loadImageFromPath(g.Z).then((e=>{if(!t.exists)return;t.imageSources=[new o.I(e,18,13)];const i={i:0,a:24},s=[];for(let t=0;t<51;t++){s[t]=[];for(let e=0;e<51;e++)s[t][e]=i}const n=Math.floor(25.5);t.drawTileFromTwoDimensionalArray(s,-n,-n)}))}))).withChild(t.buildGameObject("camera").withComponent(d.V,(t=>{t.viewSize=4})).withComponent(c.Y,(t=>{t.mouseMoveButton=0,t.maxViewSize=4})).withComponent(m.y,(t=>{t.renderWidth=50,t.renderHeight=50})))}}class C extends h.A{run(){const t=this.instantiater;return this.sceneBuilder.withChild(t.buildPrefab("background",w.l,new p.P(0,0,-1)).make()).withChild(t.buildGameObject("camera").withComponent(d.V,(t=>{t.viewSize=4})).withComponent(c.Y,(t=>{t.mouseMoveButton=0,t.maxViewSize=4})).withComponent(m.y,(t=>{t.renderWidth=50,t.renderHeight=50})))}}const k={},S="Tilemap Basic",v={unversionedId:"tutorial-2dtopdown/tilemap-basic",id:"tutorial-2dtopdown/tilemap-basic",title:"Tilemap Basic",description:"Let's find out the basic way to use the built-in engine component tilemap",source:"@site/docs/2-tutorial-2dtopdown/4-tilemap-basic.mdx",sourceDirName:"2-tutorial-2dtopdown",slug:"/tutorial-2dtopdown/tilemap-basic",permalink:"/the-world-engine.ts/build/docs/tutorial-2dtopdown/tilemap-basic",draft:!1,editUrl:"https://github.com/The-World-Space/the-world-engine.ts/tree/main/docs/docusaurus/docs/2-tutorial-2dtopdown/4-tilemap-basic.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Sprite Atlas Setup",permalink:"/the-world-engine.ts/build/docs/tutorial-2dtopdown/sprite-atlas-setup"}},x={},E=[{value:"Kind of Tilemap",id:"kind-of-tilemap",level:2},{value:"Usage of <code>CssTilemapChunkRenderer</code>",id:"usage-of-csstilemapchunkrenderer",level:2},{value:"Draw Tile From Two Dimensional Array",id:"draw-tile-from-two-dimensional-array",level:2},{value:"Mapping from String Array",id:"mapping-from-string-array",level:3},{value:"Make Grass Background",id:"make-grass-background",level:2}],O={toc:E};function T(t){let{components:e,...i}=t;return(0,n.kt)("wrapper",(0,s.Z)({},O,i,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"tilemap-basic"},"Tilemap Basic"),(0,n.kt)("p",null,"Let's find out the basic way to use the built-in engine component tilemap"),(0,n.kt)("h2",{id:"kind-of-tilemap"},"Kind of Tilemap"),(0,n.kt)("p",null,"Currently, four types of tile maps are provided as standard:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"CssTilemapRenderer")," - It's the most basic form of tilemap. You are ",(0,n.kt)("strong",{parentName:"li"},"limited in size")," and can draw tiles from a given tile set."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"CssTilemapChunkRenderer")," - As a wrapper of the ",(0,n.kt)("inlineCode",{parentName:"li"},"CssTilemapRenderer"),", it is a tilemap of ",(0,n.kt)("strong",{parentName:"li"},"infinite size"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"CssCollideTilemapRenderer")," - It is a tilemap that ",(0,n.kt)("strong",{parentName:"li"},"contains a grid collide map"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"CssCollideTilemapChunkRenderer")," - As a wrapper of the ",(0,n.kt)("inlineCode",{parentName:"li"},"CssCollideTilemapRenderer"),", it has ",(0,n.kt)("strong",{parentName:"li"},"infinite size"),".")),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"grid collide maps are used for collision handling in grid-based games. We'll talk about this later.")),(0,n.kt)("h2",{id:"usage-of-csstilemapchunkrenderer"},"Usage of ",(0,n.kt)("inlineCode",{parentName:"h2"},"CssTilemapChunkRenderer")),(0,n.kt)("p",null,"First, let's use the CssTilemapChunkRender to draw background tiles."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},'return this.sceneBuilder\n    .withChild(instantiater.buildGameObject("background", new Vector3(0, 0, -1))\n        .withComponent(CssTilemapChunkRenderer, c => {\n            c.chunkSize = 15;\n            c.tileResolutionX = 16;\n            c.tileResolutionY = 16;\n\n            AsyncImageLoader.loadImageFromPath(OverworldTileset).then(image => {\n                if (!c.exists) return;\n\n                c.imageSources = [ new TileAtlasItem(image, 18, 13) ];\n                c.drawTile(0, 0, 0, 24);\n            });\n        }))\n\n    .withChild(instantiater.buildGameObject("camera")\n        .withComponent(Camera, c => {\n            c.viewSize = 4;\n        })\n        .withComponent(EditorCameraController, c => {\n            c.mouseMoveButton = 0;\n        })\n        .withComponent(EditorGridRenderer, c => {\n            c.renderWidth = 50;\n            c.renderHeight = 50;\n        }))\n;\n')),(0,n.kt)(r.Z,{bootstrapper:f,mdxType:"DocumentGame"}),(0,n.kt)("p",null,"Let's look at the code line by line."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"c.chunkSize = 15;\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"First, I'm specifying the chunk size.\nThis is because if the chunk size is even,\nthe center of the tilemap coordinate system is (0.5, 0.5) and if it's odd,\nit's (0, 0), so we put an odd value in order to make the coordinate system (0, 0).\nThe default chunk size is 16, which is odd.")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"c.tileResolutionX = 16;\nc.tileResolutionY = 16;\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Next, the tileResolution value is specified.\nIt is recommended that the resolution of the tile map renderer be\naccurate to the resolution of the tile. In this case, the resolution of the tile is 16x16,\nso we set it to 16.")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"AsyncImageLoader.loadImageFromPath(OverworldTileset).then(image => {\n    if (!c.exists) return;\n\n    //...\n});\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"then loading the image using AsyncImageLoader.\nAsyncImageLoader is just a Promise Wrapper for an onLoad callback.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"c.exists is the code to determine if a component exists,\nand it is recommended that you check the existence for all asynchronous job callbacks\nbecause the component may have been destroyed by another element after the asynchronous operation.\n",(0,n.kt)("em",{parentName:"p"},"(For example, the most frequent problem is that if the player unmounts the game while loading the game, the component will no longer exist at the time of asynchronous callback.)")))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"c.imageSources = [ new TileAtlasItem(image, 18, 13) ];\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Then you have to specify the sprite Atlas to use in Renderer.\n18 and 13 are column count and row count")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"c.drawTile(0, 0, 0, 24);\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Finally, you can draw a tile.\nThe first two numbers are x, y values to draw tiles,\nfollowed by the index of the c.imageSources array,\nand the last is the index value of the sprite Atlas.\nOverworld Tileset's 24th tile is a grass tile.")),(0,n.kt)("h2",{id:"draw-tile-from-two-dimensional-array"},"Draw Tile From Two Dimensional Array"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},"const g = { i: 0 as const, a: 24 };\n    \nc.drawTileFromTwoDimensionalArray(\n    [\n        [g, g, g, g],\n        [g, g, g, g],\n        [g, g, g, g],\n        [g, g, g, g]\n    ],\n    0, 0\n);\n")),(0,n.kt)(r.Z,{bootstrapper:y,mdxType:"DocumentGame"}),(0,n.kt)("p",null,"You can also draw tiles through a two-dimensional array."),(0,n.kt)("p",null,"The items in the array type is ",(0,n.kt)("inlineCode",{parentName:"p"},"{ i: number, a: number }"),".\nwhere i stands for the index of c.imageSources and a stands for the index of Sprite Atlas."),(0,n.kt)("p",null,"The last parameter 0, 0 is the center coordinate to draw the tile.\nThe center coordinates span the left corner of the two-dimensional array"),(0,n.kt)("h3",{id:"mapping-from-string-array"},"Mapping from String Array"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},'c.drawTileFromTwoDimensionalArray(\n    TwoDimensionalStringMapper.map([\n        "gggg",\n        "gggg",\n        "gggg",\n        "gggg"\n    ], {\n        "g": () => ({ i: 0, a: 24 }),\n    }),\n    0, 0\n);\n')),(0,n.kt)("p",null,"Code for obtaining the same result as above.\nIt can be viewed in a more readable form by mapping through strings."),(0,n.kt)("p",null,"In future tutorials, we will use string mapping to design levels."),(0,n.kt)("h2",{id:"make-grass-background"},"Make Grass Background"),(0,n.kt)("p",null,"Now let's make a lawn."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},'.withChild(instantiater.buildGameObject("background", new Vector3(0, 0, -1))\n    .withComponent(CssTilemapChunkRenderer, c => {\n        c.chunkSize = 15;\n        c.tileResolutionX = 16;\n        c.tileResolutionY = 16;\n\n        AsyncImageLoader.loadImageFromPath(OverworldTileset).then(image => {\n            if (!c.exists) return;\n\n            c.imageSources = [ new TileAtlasItem(image, 18, 13) ];\n\n            const grass = { i: 0 as const, a: 24 };\n            const planeSize = 51;\n\n            const array2d: { i: 0; a: number; }[][] = [];\n            for (let i = 0; i < planeSize; i++) {\n                array2d[i] = [];\n                for (let j = 0; j < planeSize; j++) {\n                    array2d[i][j] = grass;\n                }\n            }\n\n            const planeSizeHalf = Math.floor(planeSize / 2);\n\n            c.drawTileFromTwoDimensionalArray(\n                array2d,\n                -planeSizeHalf, -planeSizeHalf\n            );\n        });\n    }))\n')),(0,n.kt)("p",null,"We'll use a loop because it's a simple iteration."),(0,n.kt)(r.Z,{bootstrapper:b,mdxType:"DocumentGame"}),(0,n.kt)("p",null,"There is a lawn, but I think it's too dark. In fact, the asset we use is a little dark in color."),(0,n.kt)("p",null,"Let's use the css filter to make it brighter."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/asset/Bootstrapper.ts"',title:'"src/asset/Bootstrapper.ts"'},".withComponent(CssTilemapChunkRenderer, c => {\n    c.filter.brightness = 1.5;\n    //...\n})\n")),(0,n.kt)(r.Z,{bootstrapper:C,mdxType:"DocumentGame"}),(0,n.kt)("p",null,"I think it's better now"))}T.isMDXComponent=!0},546:(t,e,i)=>{i.d(e,{W:()=>n});var s=i(8018);class n{constructor(t,e,i,n,r){this._instantiater=t.instantiater,this._gameObjectBuilder=new s.f(t,e,i,n,r)}get instantiater(){return this._instantiater}get gameObjectBuilder(){return this._gameObjectBuilder}}},7888:(t,e,i)=>{i.d(e,{s:()=>s});class s{constructor(t=null){this.ref=t}}},1269:(t,e,i)=>{i.d(e,{Y:()=>a});var s=i(6120),n=i(4532),r=i(3674),h=i(6896);class a extends r.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[h.V],this.mh=null,this.fh=!1,this.ph=1,this.Vh=new s.F,this.wh=1,this.zh=10,this.xh=5,this.Sh=5,this.bh=new n.P,this.dh=t=>{" "===t.key&&(this.Sh=this.xh,this._h(),this.transform.localPosition.copy(this.bh))},this.Bh=t=>{this.Sh+=.01*t.deltaY,this.Sh<this.wh?this.Sh=this.wh:this.Sh>this.zh&&(this.Sh=this.zh),this._h()},this._r=t=>{this.Vh.set(t.clientX/this.engine.screen.width,t.clientY/this.engine.screen.height),t.button===this.ph&&(this.fh=!0)},this.Eh=t=>{t.button===this.ph&&(this.fh=!1)},this.Mh=t=>{if(!this.fh)return;const e=t.clientX/this.engine.screen.width,i=t.clientY/this.engine.screen.height,s=e-this.Vh.x,n=i-this.Vh.y,r=this.engine.screen.width/this.engine.screen.height;this.transform.localPosition.x-=s*this.mh.viewSize*2*r,this.transform.localPosition.y+=n*this.mh.viewSize*2,this.Vh.set(e,i)},this.jh=t=>{this.fh=!1}}awake(){this.mh=this.gameObject.getComponent(h.V),this.xh=this.mh.viewSize,this.bh.copy(this.transform.localPosition),this.Sh=this.xh,this.mh.viewSize=this.Sh}onEnable(){const t=this.engine.input;t.onKeyDown.addListener(this.dh),t.onWheel.addListener(this.Bh),t.onPointerDown.addListener(this._r),t.onPointerUp.addListener(this.Eh),t.onPointerMove.addListener(this.Mh),t.onPointerLeave.addListener(this.jh)}onDisable(){const t=this.engine.input;t.onKeyDown.removeListener(this.dh),t.onWheel.removeListener(this.Bh),t.onPointerDown.removeListener(this._r),t.onPointerUp.removeListener(this.Eh),t.onPointerMove.removeListener(this.Mh),t.onPointerLeave.removeListener(this.jh)}_h(){this.mh&&(this.mh.viewSize=this.Sh)}get minViewSize(){return this.wh}set minViewSize(t){this.wh=t,this.Sh<this.wh&&(this.Sh=this.wh,this._h())}get maxViewSize(){return this.zh}set maxViewSize(t){this.zh=t,this.Sh>this.zh&&(this.Sh=this.zh,this._h())}get mouseMoveButton(){return this.ph}set mouseMoveButton(t){this.ph=t}}},983:(t,e,i)=>{i.d(e,{E:()=>s});class s{static loadImageFromPath(t){return new Promise(((e,i)=>{const s=new Image;s.onload=()=>{e(s)},s.onerror=()=>{i(new Error(`Failed to load image "${t}".`))},s.src=t}))}static loadImagesFromPath(t){return Promise.all(t.map((t=>s.loadImageFromPath(t))))}static loadImage(t){return new Promise(((e,i)=>{t.onload=()=>{e(t)},t.onerror=()=>{i(new Error("Failed to load image."))}}))}static loadImages(t){return Promise.all(t.map((t=>s.loadImage(t))))}}},291:(t,e,i)=>{i.d(e,{d:()=>s});class s{static map(t,e){const i=[];for(let s=0;s<t.length;++s){const n=[],r=t[s];for(let t=0;t<r.length;++t){const i=r[t];if(void 0===e[i])throw new Error(`conversion not found for ${i}`);n.push(e[i](t,s))}i.push(n)}return i}}},7111:(t,e,i)=>{i.d(e,{n:()=>o});var s=i(6120),n=i(4532),r=i(3674),h=i(8788),a=i(6868),l=i(3379);class o extends r.w{constructor(){super(...arguments),this.Xr=new Map,this.Yr=16,this.Kr=1,this.Jr=1,this.Qr=16,this.Zr=16,this.tn=1.001,this.sn=null,this.en=!0,this.rn=.1,this.nn=h.r.Pixelated,this.on=()=>{this.Xr.forEach(((t,e)=>{t.filter.copy(this.Ui)}))},this.Ui=new l.c(this.on),this.Hr=[],this.Wr=!1}start(){this.Wr=!0;const t=this.Hr;for(let e=0;e<t.length;++e)t[e]();this.Hr.length=0}ln(){this.Xr.forEach(((t,e)=>{const i=this.cn(e)*this.Yr*this.Kr,s=this.un(e)*this.Yr*this.Jr;t.gameObject.transform.localPosition.set(i,s,0)}))}cn(t){return parseInt(t.substring(0,t.indexOf("_")))}un(t){return parseInt(t.substring(t.indexOf("_")+1))}an(t,e){return`${t}_${e}`}dn(t,e,i,n){const r=i-t*this.Yr+this.Yr/2,h=n-e*this.Yr+this.Yr/2;return new s.F(r,h)}fn(t,e){const i=this.an(t,e);let s=this.Xr.get(i);return void 0===s&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("css_tilemap_renderer_"+t+"_"+e,new n.P(t*this.Yr*this.Kr,e*this.Yr*this.Jr,0),void 0,(new n.P).setScalar(this.tn)).withComponent(a.N,(t=>{s=t,this.sn&&(t.imageSources=this.sn),t.gridCellWidth=this.Kr,t.gridCellHeight=this.Jr,t.tileResolutionX=this.Qr,t.tileResolutionY=this.Zr,t.rowCount=this.Yr,t.columnCount=this.Yr,t.pointerEvents=this.en,t.viewScale=this.rn,t.filter.copy(this.Ui)}))),this.Xr.set(i,s)),s}gn(t,e){const i=this.an(t,e),s=this.Xr.get(i);return void 0===s?null:s}drawTile(t,e,i,s){if(!this.Wr)return void this.Hr.push((()=>{this.drawTile(t,e,i,s)}));const n=Math.floor((t+this.Yr/2)/this.Yr),r=Math.floor((e+this.Yr/2)/this.Yr),h=this.fn(n,r),a=this.dn(n,r,t,e),l=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.drawTile(a.x+l,this.Yr-a.y-1+o,i,s)}drawTileFromTwoDimensionalArray(t,e,i){if(this.Wr)for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)null!==t[s][n]&&this.drawTile(n+e,t.length-s+i-1,t[s][n].i,t[s][n].a);else this.Hr.push((()=>{this.drawTileFromTwoDimensionalArray(t,e,i)}))}clearTile(t,e){if(!this.Wr)return void this.Hr.push((()=>{this.clearTile(t,e)}));const i=Math.floor((t+this.Yr/2)/this.Yr),s=Math.floor((e+this.Yr/2)/this.Yr),n=this.gn(i,s);if(null===n)return;const r=this.dn(i,s,t,e),h=this.chunkSize%2==0?0:-.5,a=this.chunkSize%2==0?0:.5;n.clearTile(r.x+h,this.Yr-r.y-1+a)}get chunkSize(){return this.Yr}set chunkSize(t){this.Yr=t,this.ln(),this.Xr.forEach(((t,e)=>{t.rowCount=this.Yr,t.columnCount=this.Yr}))}set imageSources(t){this.Wr?(this.sn=t,this.Xr.forEach(((e,i)=>{e.imageSources=t}))):this.Hr.push((()=>{this.imageSources=t}))}get pointerEvents(){return this.en}set pointerEvents(t){this.en=t,this.Xr.forEach(((e,i)=>{e.pointerEvents=t}))}get gridCellWidth(){return this.Kr}set gridCellWidth(t){this.Kr!==t&&(this.Kr=t,this.ln(),this.Xr.forEach(((t,e)=>{t.gridCellWidth=this.Kr})))}get gridCellHeight(){return this.Jr}set gridCellHeight(t){this.Jr!==t&&(this.Jr=t,this.ln(),this.Xr.forEach(((t,e)=>{t.gridCellHeight=this.Jr})))}get tileResolutionX(){return this.Qr}set tileResolutionX(t){this.Qr!==t&&(this.Qr=t,this.Xr.forEach(((t,e)=>{t.tileResolutionX=this.Qr})))}get tileResolutionY(){return this.Zr}set tileResolutionY(t){this.Zr!==t&&(this.Zr=t,this.Xr.forEach(((t,e)=>{t.tileResolutionY=this.Zr})))}get tilemapScale(){return this.tn}set tilemapScale(t){this.tn!==t&&(this.tn=t,this.Xr.forEach(((t,e)=>{t.gameObject.transform.localScale.setScalar(this.tn)})))}get gridCenter(){const t=this.Yr%2==1?0:this.Kr/2,e=this.Yr%2==1?0:this.Jr/2;return new s.F(this.transform.localPosition.x+t,this.transform.localPosition.y+e)}get gridCenterX(){const t=this.Yr%2==1?0:this.Kr/2;return this.transform.localPosition.x+t}get gridCenterY(){const t=this.Yr%2==1?0:this.Jr/2;return this.transform.localPosition.y+t}get viewScale(){return this.rn}set viewScale(t){this.rn=t,this.Xr.forEach(((t,e)=>{t.viewScale=this.rn}))}get filter(){return this.Ui}get imageRenderingMode(){return this.nn}set imageRenderingMode(t){this.nn=t,this.Xr.forEach(((e,i)=>{e.imageRenderingMode=t}))}}},6885:(t,e,i)=>{i.d(e,{y:()=>l});var s=i(4532),n=i(3674),r=i(7888),h=i(6896),a=i(1466);class l extends n.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[h.V],this.sd=null,this.hd=null,this.Ih=1,this.Th=1,this.rd=18,this.nd=10,this.od=.2,this.dd=0,this.ad=new s.P(NaN,NaN,NaN)}awake(){const t=new r.s;this.hd=this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildGameObject("grid-renderer",void 0,void 0,new s.P(this.od,this.od,this.od)).active(!1).withComponent(a.w,(t=>{const e=document.createElement("div");e.style.backgroundImage="                        repeating-linear-gradient(#999 0 1px, transparent 1px 100%),                        repeating-linear-gradient(90deg, #999 0 1px, transparent 1px 100%)",e.style.backgroundSize=this.Ih/this.od/.1+"px "+this.Th/this.od/.1+"px",t.elementWidth=this.rd/this.od,t.elementHeight=this.nd/this.od,t.pointerEvents=!1,t.element=e,t.viewScale=.1})).getComponent(a.w,t)),this.sd=t.ref}onEnable(){this.hd.exists&&(this.hd.activeSelf=!0)}onDisable(){this.hd.exists&&(this.hd.activeSelf=!1)}update(){const t=this.transform.position,e=1/this.od/.1,i=this.rd*e/2,s=this.nd*e/2,n=this.Ih*e,r=this.Th*e,h=i%n,a=s%r;if(!t.equals(this.ad)){const i=this.hd.transform.position;i.copy(t),i.z+=this.dd,this.sd.element.style.backgroundPosition=-t.x*e+h+n/2-.5+"px "+(t.y*e+a+r/2-.5)+"px"}}onDestroy(){var t;null===(t=this.hd)||void 0===t||t.destroy()}ld(){const t=this.sd;t&&(t.element.style.backgroundSize=this.Ih/this.od/.1+"px "+this.Th/this.od/.1+"px")}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t,this.ld()}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t,this.ld()}get renderWidth(){return this.rd}set renderWidth(t){this.rd=t,this.sd&&(this.sd.elementWidth=this.rd/this.od)}get renderHeight(){return this.nd}set renderHeight(t){this.nd=t,this.sd&&(this.sd.elementHeight=this.nd/this.od)}get lineWidth(){return.1*this.od}set lineWidth(t){this.od=t/.1;const e=this.sd;e&&(this.ld(),e.elementWidth=this.rd/this.od,e.elementHeight=this.nd/this.od,e.gameObject.transform.localScale.setScalar(this.od))}get zOffset(){return this.dd}set zOffset(t){this.dd=t}}},251:(t,e,i)=>{i.d(e,{N:()=>n});var s=i(3514);class n extends s.C{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.rl=-100}update(){this.transform.localPosition.z=this.engine.cameraContainer.camera.transform.position.z+this.rl}get offset(){return this.rl}set offset(t){this.rl=t}}},1466:(t,e,i)=>{i.d(e,{w:()=>r});var s=i(4627),n=i(6924);class r extends n.Y{constructor(){super(...arguments),this.tu=1,this.su=1,this.iu=!1,this.Ca=null}renderInitialize(){var t;null===(t=this.Ca)||void 0===t||t.call(this),this.htmlElement||(this.element=null)}updateCenterOffset(t){if(!this.css3DObject)return;let e,i;if(this.iu)if(this.css3DObject.element.parentElement){const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="",e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t}else{const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="";const s=this.css3DObject.element.style.transform;this.css3DObject.element.style.transform="translateX(1000000px)",document.body.appendChild(this.css3DObject.element),e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t,this.css3DObject.element.style.transform=s,document.body.removeChild(this.css3DObject.element)}else e=this.tu,i=this.su;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(s.w.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.iu?(this.css3DObject.scale.set(e,e,e),this.updateCenterOffset(!1)):(this.css3DObject.element.style.width=this.tu/this.viewScale+"px",this.css3DObject.element.style.height=this.su/this.viewScale+"px",this.css3DObject.scale.set(e,e,e)),t&&(s.w.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get element(){return this.htmlElement}set element(t){const e=this.htmlElement=null!=t?t:document.createElement("div");this.readyToDraw?this.hu(e):this.Ca=()=>this.hu(e)}hu(t){this.iu?(t.style.width="auto",t.style.height="auto"):(t.style.width=this.tu/this.viewScale+"px",t.style.height=this.su/this.viewScale+"px");const e=this.initializeBaseComponents(!0);s.w.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get elementWidth(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetWidth*this.viewScale;return this.htmlElement.style.display=t,e}return 0}return this.tu}set elementWidth(t){this.iu||(this.tu=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get elementHeight(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetHeight*this.viewScale;return this.htmlElement.style.display=t,e}return 0}return this.su}set elementHeight(t){this.iu||(this.su=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get autoSize(){return this.iu}set autoSize(t){this.iu=t,this.htmlElement&&(t?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tu/this.viewScale+"px",this.htmlElement.style.height=this.su/this.viewScale+"px"))}}},6868:(t,e,i)=>{i.d(e,{I:()=>a,N:()=>l});var s=i(6120),n=i(4627),r=i(6924),h=i(8788);class a{constructor(t,e=1,i=1){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);this.uc=t,this.Sa=i,this.pa=e}get htmlImageElement(){return this.uc}get columnCount(){return this.pa}get rowCount(){return this.Sa}}class l extends r.Y{constructor(){super(...arguments),this.pa=10,this.Sa=10,this.Kr=1,this.Jr=1,this.Qr=16,this.Zr=16,this.sn=null,this.nn=h.r.Pixelated,this.Hr=[]}renderInitialize(){this.dc();const t=this.Hr;for(let e=0;e<t.length;++e)t[e]();this.Hr.length=0}updateCenterOffset(t){if(!this.css3DObject)return;const e=this.pa*this.Kr,i=this.Sa*this.Jr;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(n.w.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement,s=this.pa*this.Kr,r=this.Sa*this.Jr;i.style.width=s/e+"px",i.style.height=r/e+"px",this.css3DObject.scale.set(e,e,e),t&&(n.w.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}dc(){const t=this.pa*this.Kr,e=this.Sa*this.Jr,i=this.pa*this.Qr,s=this.Sa*this.Zr;this.htmlElement=document.createElement("canvas"),this.htmlElement.width=i,this.htmlElement.height=s,this.htmlElement.style.imageRendering=this.nn,this.htmlElement.style.width=t/this.viewScale+"px",this.htmlElement.style.height=e/this.viewScale+"px";const r=this.initializeBaseComponents(!1);n.w.updateRawObject3DWorldMatrixRecursively(r),this.transform.enqueueRenderAttachedObject3D(r)}drawTile(t,e,i,s){if(!this.readyToDraw)return void this.Hr.push((()=>this.drawTile(t,e,i,s)));const n=this.htmlElement.getContext("2d"),r=this.sn[i];if(1===r.rowCount&&1===r.columnCount)n.drawImage(r.htmlImageElement,0,0,this.Qr,this.Zr,t*this.Qr,e*this.Zr,this.Qr,this.Zr);else{if(void 0===s)throw new Error("Atlas index is required.");{const i=Math.floor(s/r.columnCount),h=s%r.columnCount,a=r.htmlImageElement.width/r.columnCount,l=r.htmlImageElement.height/r.rowCount;n.drawImage(r.htmlImageElement,h*a,i*l,a,l,t*this.Qr,e*this.Zr,this.Qr,this.Zr)}}}drawTileFromTwoDimensionalArray(t,e,i){if(!this.readyToDraw)return void this.Hr.push((()=>this.drawTileFromTwoDimensionalArray(t,e,i)));const s=this.htmlElement.getContext("2d");for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.length;t++){const h=r[t];if(null===h)continue;const a=this.sn[h.i];if(1===a.rowCount&&1===a.columnCount)s.drawImage(a.htmlImageElement,0,0,this.Qr,this.Zr,t*this.Qr+e*this.Qr,n*this.Zr+i*this.Zr,this.Qr,this.Zr);else{if(void 0===h.a)throw new Error("Atlas index is required.");{const r=h.a%a.columnCount,l=Math.floor(h.a/a.columnCount),o=a.htmlImageElement.width/a.columnCount,d=a.htmlImageElement.height/a.rowCount;s.drawImage(a.htmlImageElement,r*o,l*d,o,d,t*this.Qr+e*this.Qr,n*this.Zr+i*this.Zr,this.Qr,this.Zr)}}}}}clearTile(t,e){if(!this.readyToDraw)return void this.Hr.push((()=>this.clearTile(t,e)));this.htmlElement.getContext("2d").clearRect(t*this.Qr,e*this.Zr,this.Qr,this.Zr)}set imageSources(t){if(this.readyToDraw){this.sn=t;for(let e=0;e<t.length;++e)if(!t[e].htmlImageElement.complete)throw new Error(`Image ${t[e].htmlImageElement.src} is not loaded.`)}else this.Hr.push((()=>this.imageSources=t))}get columnCount(){return this.pa}set columnCount(t){if(this.pa=t,this.htmlElement){const t=this.pa*this.Kr,e=this.pa*this.Qr;this.htmlElement.width=e,this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get rowCount(){return this.Sa}set rowCount(t){if(this.Sa=t,this.htmlElement){const t=this.Sa*this.Jr,e=this.Sa*this.Zr;this.htmlElement.height=e,this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellWidth(){return this.Kr}set gridCellWidth(t){if(this.Kr=t,this.htmlElement){const t=this.pa*this.Kr;this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellHeight(){return this.Jr}set gridCellHeight(t){if(this.Jr=t,this.htmlElement){const t=this.Sa*this.Jr;this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get tileResolutionX(){return this.Qr}set tileResolutionX(t){if(this.Qr=t,this.htmlElement){const t=this.pa*this.Qr;this.htmlElement.width=t}}get tileResolutionY(){return this.Zr}set tileResolutionY(t){if(this.Zr=t,this.htmlElement){const t=this.Sa*this.Zr;this.htmlElement.height=t}}get gridCenter(){const t=this.columnCount%2==1?0:this.Kr/2,e=this.rowCount%2==1?0:this.Jr/2;return new s.F(this.transform.position.x+t,this.transform.position.y+e)}get gridCenterX(){return this.transform.position.x+(this.columnCount%2==1?0:this.Kr/2)}get gridCenterY(){return this.transform.position.y+(this.rowCount%2==1?0:this.Jr/2)}get imageRenderingMode(){return this.nn}set imageRenderingMode(t){this.nn=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.nn)}}},3514:(t,e,i)=>{i.d(e,{C:()=>n});var s=i(3674);class n extends s.w{}},9484:(t,e,i)=>{i.d(e,{Z:()=>s});const s=i.p+"assets/images/Overworld_Tileset-1c44075b314e79caada3455aa25f5809.png"}}]);