"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[744],{4529:(t,e,i)=>{i.r(e),i.d(e,{assets:()=>y,contentTitle:()=>f,default:()=>x,frontMatter:()=>g,metadata:()=>b,toc:()=>w});var s=i(7462),r=(i(7294),i(3905)),h=i(7346),n=i(3274),o=i(9384),a=i(6324),l=i(6896),c=i(1539),d=i(2684),p=i(5365);class u extends c.W{constructor(){super(...arguments),this._trackObject=new o.s,this._camera=new o.s}withTrackObject(t){return this._trackObject=t,this}getCamera(t){return this._camera=t,this}make(){return this.gameObjectBuilder.withComponent(d.V).withComponent(p.K,(t=>{t.smoothTrack=!0,this._trackObject.ref&&t.setTrackTarget(this._trackObject.ref)})).getComponent(d.V,this._camera)}}class m extends n.A{run(){const t=this.instantiater,e=new o.s,i=new o.s;return this.sceneBuilder.withChild(t.buildPrefab("camera",u).withTrackObject(e).getCamera(i).make()).withChild(t.buildGameObject("player").withComponent(a._).withComponent(l.j).getGameObject(e))}}const g={},f="Prefab",b={unversionedId:"getting-started/prefab",id:"getting-started/prefab",title:"Prefab",description:"If you keep writing scenes on the bootstrapper, the bootstrapper will become too big.",source:"@site/docs/1-getting-started/7-prefab.mdx",sourceDirName:"1-getting-started",slug:"/getting-started/prefab",permalink:"/the-world-engine.ts/build/docs/getting-started/prefab",draft:!1,editUrl:"https://github.com/The-World-Space/the-world-engine.ts/tree/main/docs/docusaurus/docs/1-getting-started/7-prefab.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Get Component",permalink:"/the-world-engine.ts/build/docs/getting-started/get-component"},next:{title:"Add/Remove Object Dynamically",permalink:"/the-world-engine.ts/build/docs/getting-started/add-object-dynamically"}},y={},w=[{value:"Make a prefab",id:"make-a-prefab",level:2},{value:"Add a prefab to the builder",id:"add-a-prefab-to-the-builder",level:2}],C={toc:w};function x(t){let{components:e,...i}=t;return(0,r.kt)("wrapper",(0,s.Z)({},C,i,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"prefab"},"Prefab"),(0,r.kt)("p",null,"If you keep writing scenes on the bootstrapper, the bootstrapper will become too big."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"You can use prefab to separate scene builds"),". It's like separating components in React development."),(0,r.kt)("h2",{id:"make-a-prefab"},"Make a prefab"),(0,r.kt)("p",null,"We going to make a camera prefab that tracks a specific object."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="./src/asset/prefab/CameraPrefab.ts"',title:'"./src/asset/prefab/CameraPrefab.ts"'},'import { \n    Camera,\n    GameObject,\n    GameObjectBuilder,\n    Prefab,\n    PrefabRef,\n    TrackCameraController\n} from "the-world-engine";\n\nexport class CameraPrefab extends Prefab {\n    private _trackObject = new PrefabRef<GameObject>();\n    private _camera = new PrefabRef<Camera>();\n\n    //If you add a value inside the prefab from the outside, you can create the with method\n    public withTrackObject(trackObject: PrefabRef<GameObject>): this {\n        this._trackObject = trackObject;\n        return this;\n    }\n\n    //When receiving the value inside the prefab from the outside, it is possible by creating the get method\n    public getCamera(componentRef: PrefabRef<Camera>): this {\n        this._camera = componentRef;\n        return this;\n    }\n\n    public override make(): GameObjectBuilder {\n        return this.gameObjectBuilder\n            .withComponent(Camera)\n            .withComponent(TrackCameraController, c => {\n                c.smoothTrack = true;\n                if (this._trackObject.ref) c.setTrackTarget(this._trackObject.ref);\n            })\n            .getComponent(Camera, this._camera)\n        ;\n    }\n}\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},'It is recommended that the method of exporting something from a prefab starts with the name "with"\nAnd it is recommended that the method of getting something from the prefab starts with the name "get".')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},'You can see that the implementation of the "get" method and the "with" method is the same, because it works as a call by reference.'),(0,r.kt)("p",{parentName:"admonition"},"Eventually, the behavior is determined by whether the reference is read or written inside the prefab."),(0,r.kt)("p",{parentName:"admonition"},"For this code, ",(0,r.kt)("inlineCode",{parentName:"p"},"this._camera"),' will be exposed as "get" method because the value was writed at ',(0,r.kt)("inlineCode",{parentName:"p"},".getComponent(Camera, this._camera)")),(0,r.kt)("p",{parentName:"admonition"},"And ",(0,r.kt)("inlineCode",{parentName:"p"},"this._trackObject"),' will be exposed as "with" method because the value was readed at ',(0,r.kt)("inlineCode",{parentName:"p"},"if (this._trackObject.ref) c.setTrackTarget(this._trackObject.ref);"))),(0,r.kt)("h2",{id:"add-a-prefab-to-the-builder"},"Add a prefab to the builder"),(0,r.kt)("p",null,"Now we can create camera from CameraPrefab."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="./src/asset/Bootstrapper.ts"',title:'"./src/asset/Bootstrapper.ts"'},'import { /*...*/ } from "the-world-engine";\nimport { CameraPrefab } from "./prefab/CameraPrefab";\n\nexport class Bootstrapper extends BaseBootstrapper {\n    public run(): SceneBuilder {\n        const instantiater = this.instantiater;\n\n        const trackObject = new PrefabRef<GameObject>();\n        const camera = new PrefabRef<Camera>();\n\n        return this.sceneBuilder\n            .withChild(instantiater.buildPrefab("camera", CameraPrefab) // build prefab!\n                .withTrackObject(trackObject)\n                .getCamera(camera)\n                .make())\n\n            .withChild(instantiater.buildGameObject("player")\n                .withComponent(CssSpriteRenderer)\n                .withComponent(PlayerGridMovementController)\n                .getGameObject(trackObject))\n        ;\n    }\n}\n')),(0,r.kt)(h.Z,{bootstrapper:m,allowScroll:!0,mdxType:"DocumentGame"}))}x.isMDXComponent=!0},1539:(t,e,i)=>{i.d(e,{W:()=>r});var s=i(6649);class r{constructor(t,e,i,r,h){this._private__instantiater=t.instantiater,this._private__gameObjectBuilder=new s.f(t,e,i,r,h)}get instantiater(){return this._private__instantiater}get gameObjectBuilder(){return this._private__gameObjectBuilder}}},9384:(t,e,i)=>{i.d(e,{s:()=>s});class s{constructor(t=null){this.ref=t}}},6896:(t,e,i)=>{i.d(e,{j:()=>a});var s=i(6120),r=i(5924);class h{constructor(t,e){this.nh=t,this.ah=e,this.eu=0,this.ru=0,this.ou=0,this.uu=null,this.lu=!0}calculateFCost(){this.ou=this.eu+this.ru}equals(t){return this.nh===t.nh&&this.ah===t.ah}get x(){return this.nh}get y(){return this.ah}get gCost(){return this.eu}set gCost(t){this.eu=t}get hCost(){return this.ru}set hCost(t){this.ru=t}get fCost(){return this.ou}set fCost(t){this.ou=t}get isWalkable(){return this.lu}set isWalkable(t){this.lu=t}get previousNode(){return this.uu}set previousNode(t){this.uu=t}}class n{constructor(t,e=.5,i=.5,s=1e3){var r;this.pr=null!==(r=null==t?void 0:t.slice())&&void 0!==r?r:[],this.wl=e,this.Nl=i,this.Pl=s}addCollideMap(t){this.pr.push(t)}removeCollideMap(t){const e=this.pr.indexOf(t);e>=0&&this.pr.splice(e,1)}removeAllCollideMaps(){this.pr.length=0}findPath(t,e){const i=new h(t.x,t.y),s=new h(e.x,e.y);if(this.Ar(i.x,i.y))return null;if(this.Ar(s.x,s.y))return null;const r=[],n=[];i.gCost=0,i.hCost=this._l(i,s),i.calculateFCost(),r.push(i);let o=0;for(;r.length>0&&o<this.Pl;){o++;const t=this.Cl(r);if(t.equals(s))return this.Ml(t);r.splice(r.indexOf(t),1),n.push(t);const e=this.gl(t);for(let i=0;i<e.length;++i){const h=e[i];if(void 0!==n.find((t=>t.equals(h))))continue;if(h.gCost=Number.MAX_VALUE,h.calculateFCost(),h.previousNode=null,this.Ar(h.x,h.y)){n.push(h);continue}const o=t.gCost+this._l(t,h);o<h.gCost&&(h.previousNode=t,h.gCost=o,h.hCost=this._l(h,s),h.calculateFCost(),void 0===r.find((t=>t.equals(h)))&&r.push(h))}}return null}gl(t){const e=[];return e.push(new h(t.x,t.y-1)),e.push(new h(t.x+1,t.y)),e.push(new h(t.x,t.y+1)),e.push(new h(t.x-1,t.y)),e}Ml(t){const e=[];let i=t;for(;i.previousNode;)e.push(new s.F(i.x,i.y)),i=i.previousNode;return e.push(new s.F(i.x,i.y)),e.reverse()}_l(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}Cl(t){let e=t[0];for(let i=1;i<t.length;++i)t[i].fCost<e.fCost&&(e=t[i]);return e}Ar(t,e){const i=this.pr;for(let s=0;s<i.length;++s){const r=i[s];if(r.checkCollision(t*r.gridCellWidth+r.gridCenterX,e*r.gridCellHeight+r.gridCenterY,this.wl,this.Nl))return!0}return!1}}var o=i(1370);class a extends o.T{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Mh=8,this.Ph=1,this.Th=1,this.pr=[],this.Ih=.5,this.yh=new s.F,this.Eh=new s.F,this.Gh=new s.F,this.Lh=new s.F,this.Rh=new r.n,this.Uh=new r.n,this.mr=null,this.gr=null,this.Hh=!1,this.Kh=null,this.Oh=0,this.Wh=null,this.Fh=new s.F,this.qh=!0,this.Bh=new s.F,this.Jh=new s.F,this.Nh=-1,this.Qh=new s.F,this.Xh=.3,this.vr=t=>{if(0!==t.button)return;this.Hh=!1;const e=this.engine.time.unscaledTime;e-this.Nh<this.Xh?this.Qh.equals(t.gridPosition)&&(this.Yh(t),this.Nh=-1):(this.Nh=e,this.Qh.copy(t.gridPosition))}}start(){this.gr=new n(this.pr,this.Th*this.Ih,this.Ph*this.Ih);const t=this.transform,e=t.position;e.x=this.yh.x+this.Lh.x*this.Th,e.y=this.yh.y+this.Lh.y*this.Ph,this.Eh.set(t.localPosition.x,t.localPosition.y);const i=t.parent;i&&this.Fh.set(i.position.x,i.position.y)}update(){var t;null===(t=this.Wh)||void 0===t||t.call(this),this.qh&&this.Zh(),this.$h(),this.Dr()}Zh(){if(this.isMoving)return void this.Mr();const t=this.engine.input.map,e=this.Eh;if(t.get("w")||t.get("ArrowUp")){if(this.direction=o.N.Up,this.Ar(e.x,e.y+this.Ph))return;this.Gh.set(e.x,e.y+this.Ph),this.Vr(),this.isMoving=!0}else if(t.get("s")||t.get("ArrowDown")){if(this.direction=o.N.Down,this.Ar(e.x,e.y-this.Ph))return;this.Gh.set(e.x,e.y-this.Ph),this.Vr(),this.isMoving=!0}else if(t.get("a")||t.get("ArrowLeft")){if(this.direction=o.N.Left,this.Ar(e.x-this.Th,e.y))return;this.Gh.set(e.x-this.Th,e.y),this.Vr(),this.isMoving=!0}else if(t.get("d")||t.get("ArrowRight")){if(this.direction=o.N.Right,this.Ar(e.x+this.Th,e.y))return;this.Gh.set(e.x+this.Th,e.y),this.Vr(),this.isMoving=!0}}Tr(t){const e=this.engine.input.map;return e.get("w")||e.get("ArrowUp")?(this.direction=o.N.Up,!this.Ar(t.x,t.y+this.Ph)&&(this.Gh.set(t.x,t.y+this.Ph),this.Vr(),!0)):e.get("s")||e.get("ArrowDown")?(this.direction=o.N.Down,!this.Ar(t.x,t.y-this.Ph)&&(this.Gh.set(t.x,t.y-this.Ph),this.Vr(),!0)):e.get("a")||e.get("ArrowLeft")?(this.direction=o.N.Left,!this.Ar(t.x-this.Th,t.y)&&(this.Gh.set(t.x-this.Th,t.y),this.Vr(),!0)):!(!e.get("d")&&!e.get("ArrowRight"))&&(this.direction=o.N.Right,!this.Ar(t.x+this.Th,t.y)&&(this.Gh.set(t.x+this.Th,t.y),this.Vr(),!0))}Vr(){this.Rh.invoke(Math.floor((this.Gh.x-this.yh.x)/this.Th),Math.floor((this.Gh.y-this.yh.y)/this.Ph))}Ir(){this.Uh.invoke(Math.floor((this.Eh.x-this.yh.x)/this.Th),Math.floor((this.Eh.y-this.yh.y)/this.Ph))}Mr(){const t=this.engine.input.map;(t.get("w")||t.get("ArrowUp")||t.get("s")||t.get("ArrowDown")||t.get("a")||t.get("ArrowLeft")||t.get("d")||t.get("ArrowRight"))&&(this.Hh=!1)}$h(){if(!this.Hh)return;const t=this.transform,e=this.Bh.set(t.localPosition.x,t.localPosition.y),i=this.Kh[this.Oh];if(i.distanceTo(e)<this.Mh*this.engine.time.deltaTime){if(this.Oh++,this.Oh>=this.Kh.length)return void(this.Hh=!1);this.Ir()}if(this.Ar(i.x,i.y))return void(this.Hh=!1);if(this.Gh.equals(this.Kh[this.Oh]))return;this.Gh.copy(this.Kh[this.Oh]),this.Vr();const s=this.Kh[this.Oh-1].x,r=this.Kh[this.Oh-1].y,h=this.Kh[this.Oh].x,n=this.Kh[this.Oh].y;r<n?this.direction=o.N.Up:r>n?this.direction=o.N.Down:s<h?this.direction=o.N.Right:s>h&&(this.direction=o.N.Left),this.isMoving=!0}Dr(){if(!this.isMoving)return;const t=this.transform,e=this.Bh.set(t.localPosition.x,t.localPosition.y);let i=e.distanceTo(this.Gh);const s=this.Mh*this.engine.time.deltaTime;i<s&&this.Tr(this.Gh)&&(i=e.distanceTo(this.Gh),this.Ir());const r=this.Jh.copy(this.Gh).sub(e).normalize();i<s?(this.isMoving=!1,this.Eh.copy(this.Gh),t.localPosition.x=this.Eh.x,t.localPosition.y=this.Eh.y,this.Ir()):(r.multiplyScalar(s),this.gameObject.transform.localPosition.x+=r.x,this.gameObject.transform.localPosition.y+=r.y)}Ar(t,e){t+=this.Fh.x,e+=this.Fh.y;const i=this.pr;for(let s=0;s<i.length;++s)if(i[s].checkCollision(t,e,this.Ih,this.Ih))return!0;return!1}Yh(t){if(this.Hh)return this.Hh=!1,void(this.Wh=()=>{this.tryStartPathfind(t.gridPosition)});this.Wh=()=>{this.tryStartPathfind(t.gridPosition)}}tryStartPathfind(t){if(this.Hh)return!1;this.Wh=null;const e=this.Kh=this.gr.findPath(this.positionInGrid,t);if(!e||e.length<=1)return!1;for(let i=0;i<e.length;++i){const t=e[i];t.x=t.x*this.Th+this.yh.x,t.y=t.y*this.Ph+this.yh.y}return this.Oh=1,this.isMoving=!0,this.Hh=!0,!0}cancelPathfind(){this.Hh=!1}get onMoveToTarget(){return this.Rh}get onMovedToTarget(){return this.Uh}teleport(t){this.isMoving=!1,this.Hh=!1,this.Eh.copy(t).multiplyScalar(this.Th).add(this.yh),this.Gh.copy(this.Eh),this.transform.localPosition.x=this.Eh.x,this.transform.localPosition.y=this.Eh.y,this.Vr(),this.Ir()}get speed(){return this.Mh}set speed(t){this.Mh=t}get gridCenter(){return this.yh}set gridCenter(t){this.yh.copy(t)}get gridCellHeight(){return this.Ph}set gridCellHeight(t){this.Ph=t}get gridCellWidth(){return this.Th}set gridCellWidth(t){this.Th=t}set initPosition(t){this.Lh.copy(t)}set gridPointer(t){this.mr&&this.mr.onPointerDown.removeListener(this.vr),this.mr=t,this.mr&&this.mr.onPointerDown.addListener(this.vr)}get gridPointer(){return this.mr}addCollideMap(t){var e;this.pr.push(t),null===(e=this.gr)||void 0===e||e.addCollideMap(t)}removeCollideMap(t){var e;const i=this.pr.indexOf(t);i>=0&&(this.pr.splice(i,1),null===(e=this.gr)||void 0===e||e.removeCollideMap(t))}removeAllCollideMaps(){var t;this.pr.length=0,null===(t=this.gr)||void 0===t||t.removeAllCollideMaps()}setGridInfoFromCollideMap(t){this.Th=t.gridCellWidth,this.Ph=t.gridCellHeight,this.yh.set(t.gridCenterX,t.gridCenterY)}get positionInGrid(){return new s.F(Math.floor((this.transform.localPosition.x-this.yh.x)/this.Th),Math.floor((this.transform.localPosition.y-this.yh.y)/this.Ph))}get receiveKeyboardInput(){return this.qh}set receiveKeyboardInput(t){this.qh=t}}},5365:(t,e,i)=>{i.d(e,{K:()=>a});var s=i(6120),r=i(4532),h=i(9542),n=i(8172),o=i(2684);class a extends n.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[o.V],this.Ur=null,this.kr=new s.F,this.Or=20,this.br=1,this.Lr=!1,this.jr=!1,this.yr=6,this.qr=new r.P}start(){if(this.Ur){const t=this.qr.copy(this.Ur.transform.position);t.z+=this.Or,this.transform.position.copy(t)}}update(){const t=this.qr.copy(this.Ur.transform.position);t.z+=this.Or,t.x+=this.kr.x,t.y+=this.kr.y;const e=this.transform;if(this.jr){const i=this.engine.time.deltaTime,s=this.yr,r=h.u1(e.position.x,t.x,s,i),n=h.u1(e.position.y,t.y,s,i),o=h.u1(e.position.z,t.z,s,i);e.position.set(r,n,o)}else e.position.copy(t);this.Lr&&(e.localPosition.x=Math.round(e.localPosition.x/this.br)*this.br,e.localPosition.y=Math.round(e.localPosition.y/this.br)*this.br)}setTrackTarget(t){this.Ur=t}get targetOffset(){return this.kr}set targetOffset(t){this.kr.copy(t)}get cameraDistanceOffset(){return this.Or}set cameraDistanceOffset(t){this.Or=t}get pixelPerfectUnit(){return this.br}set pixelPerfectUnit(t){this.br=t}get pixelPerfect(){return this.Lr}set pixelPerfect(t){this.Lr=t}get smoothTrack(){return this.jr}set smoothTrack(t){this.jr=t}get smoothLambda(){return this.yr}set smoothLambda(t){this.yr=t}}},1370:(t,e,i)=>{i.d(e,{N:()=>s,T:()=>n});var s,r,h=i(8172);(r=s||(s={}))[r.Up=0]="Up",r[r.Down=1]="Down",r[r.Left=2]="Left",r[r.Right=3]="Right";class n extends h.w{constructor(){super(...arguments),this.Do=s.Down,this.xo=!1}get direction(){return this.Do}set direction(t){this.Do=t}get isMoving(){return this.xo}set isMoving(t){this.xo=t}}}}]);