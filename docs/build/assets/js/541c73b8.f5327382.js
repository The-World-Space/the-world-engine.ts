"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[744],{4529:(t,e,i)=>{i.r(e),i.d(e,{assets:()=>w,contentTitle:()=>f,default:()=>x,frontMatter:()=>g,metadata:()=>b,toc:()=>y});var s=i(7462),h=(i(7294),i(3905)),r=i(9017),n=i(708),o=i(7888),a=i(8788),l=i(4394),c=i(546),d=i(6896),p=i(7421);class u extends c.W{constructor(){super(...arguments),this._trackObject=new o.s,this._camera=new o.s}withTrackObject(t){return this._trackObject=t,this}getCamera(t){return this._camera=t,this}make(){return this.gameObjectBuilder.withComponent(d.V).withComponent(p.K,(t=>{t.lerpTrack=!0,this._trackObject.ref&&t.setTrackTarget(this._trackObject.ref)})).getComponent(d.V,this._camera)}}class m extends n.A{run(){const t=this.instantiater,e=new o.s,i=new o.s;return this.sceneBuilder.withChild(t.buildPrefab("camera",u).withTrackObject(e).getCamera(i).make()).withChild(t.buildGameObject("player").withComponent(a._).withComponent(l.j).getGameObject(e))}}const g={},f="Prefab",b={unversionedId:"getting-started/prefab",id:"getting-started/prefab",title:"Prefab",description:"If you keep writing scenes on the bootstrapper, the bootstrapper will become too big.",source:"@site/docs/1-getting-started/7-prefab.mdx",sourceDirName:"1-getting-started",slug:"/getting-started/prefab",permalink:"/the-world-engine.ts/build/docs/getting-started/prefab",draft:!1,editUrl:"https://github.com/The-World-Space/the-world-engine.ts/tree/main/docs/docusaurus/docs/1-getting-started/7-prefab.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Get Component",permalink:"/the-world-engine.ts/build/docs/getting-started/get-component"},next:{title:"Add/Remove Object Dynamically",permalink:"/the-world-engine.ts/build/docs/getting-started/add-object-dynamically"}},w={},y=[{value:"Make a prefab",id:"make-a-prefab",level:2},{value:"Add a prefab to the builder",id:"add-a-prefab-to-the-builder",level:2}],C={toc:y};function x(t){let{components:e,...i}=t;return(0,h.kt)("wrapper",(0,s.Z)({},C,i,{components:e,mdxType:"MDXLayout"}),(0,h.kt)("h1",{id:"prefab"},"Prefab"),(0,h.kt)("p",null,"If you keep writing scenes on the bootstrapper, the bootstrapper will become too big."),(0,h.kt)("p",null,(0,h.kt)("strong",{parentName:"p"},"You can use prefab to separate scene builds"),". It's like separating components in React development."),(0,h.kt)("h2",{id:"make-a-prefab"},"Make a prefab"),(0,h.kt)("p",null,"We going to make a camera prefab that tracks a specific object."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="./src/asset/prefab/CameraPrefab.ts"',title:'"./src/asset/prefab/CameraPrefab.ts"'},'import { \n    Camera,\n    GameObject,\n    GameObjectBuilder,\n    Prefab,\n    PrefabRef,\n    TrackCameraController\n} from "the-world-engine";\n\nexport class CameraPrefab extends Prefab {\n    private _trackObject = new PrefabRef<GameObject>();\n    private _camera = new PrefabRef<Camera>();\n\n    //If you add a value inside the prefab from the outside, you can create the with method\n    public withTrackObject(trackObject: PrefabRef<GameObject>): this {\n        this._trackObject = trackObject;\n        return this;\n    }\n\n    //When receiving the value inside the prefab from the outside, it is possible by creating the get method\n    public getCamera(componentRef: PrefabRef<Camera>): this {\n        this._camera = componentRef;\n        return this;\n    }\n\n    public override make(): GameObjectBuilder {\n        return this.gameObjectBuilder\n            .withComponent(Camera)\n            .withComponent(TrackCameraController, c => {\n                c.lerpTrack = true;\n                if (this._trackObject.ref) c.setTrackTarget(this._trackObject.ref);\n            })\n            .getComponent(Camera, this._camera)\n        ;\n    }\n}\n')),(0,h.kt)("admonition",{type:"tip"},(0,h.kt)("p",{parentName:"admonition"},'It is recommended that the method of exporting something from a prefab starts with the name "with"\nAnd it is recommended that the method of getting something from the prefab starts with the name "get".')),(0,h.kt)("admonition",{type:"tip"},(0,h.kt)("p",{parentName:"admonition"},'You can see that the implementation of the "get" method and the "with" method is the same, because it works as a call by reference.'),(0,h.kt)("p",{parentName:"admonition"},"Eventually, the behavior is determined by whether the reference is read or written inside the prefab."),(0,h.kt)("p",{parentName:"admonition"},"For this code, ",(0,h.kt)("inlineCode",{parentName:"p"},"this._camera"),' will be exposed as "get" method because the value was writed at ',(0,h.kt)("inlineCode",{parentName:"p"},".getComponent(Camera, this._camera)")),(0,h.kt)("p",{parentName:"admonition"},"And ",(0,h.kt)("inlineCode",{parentName:"p"},"this._trackObject"),' will be exposed as "with" method because the value was readed at ',(0,h.kt)("inlineCode",{parentName:"p"},"if (this._trackObject.ref) c.setTrackTarget(this._trackObject.ref);"))),(0,h.kt)("h2",{id:"add-a-prefab-to-the-builder"},"Add a prefab to the builder"),(0,h.kt)("p",null,"Now we can create camera from CameraPrefab."),(0,h.kt)("pre",null,(0,h.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="./src/asset/Bootstrapper.ts"',title:'"./src/asset/Bootstrapper.ts"'},'import { /*...*/ } from "the-world-engine";\nimport { CameraPrefab } from "./prefab/CameraPrefab";\n\nexport class Bootstrapper extends BaseBootstrapper {\n    public run(): SceneBuilder {\n        const instantiater = this.instantiater;\n\n        const trackObject = new PrefabRef<GameObject>();\n        const camera = new PrefabRef<Camera>();\n\n        return this.sceneBuilder\n            .withChild(instantiater.buildPrefab("camera", CameraPrefab) // build prefab!\n                .withTrackObject(trackObject)\n                .getCamera(camera)\n                .make())\n\n            .withChild(instantiater.buildGameObject("player")\n                .withComponent(CssSpriteRenderer)\n                .withComponent(PlayerGridMovementController)\n                .getGameObject(trackObject))\n        ;\n    }\n}\n')),(0,h.kt)(r.Z,{bootstrapper:m,allowScroll:!0,mdxType:"DocumentGame"}))}x.isMDXComponent=!0},546:(t,e,i)=>{i.d(e,{W:()=>h});var s=i(8018);class h{constructor(t,e,i,h,r){this._instantiater=t.instantiater,this._gameObjectBuilder=new s.f(t,e,i,h,r)}get instantiater(){return this._instantiater}get gameObjectBuilder(){return this._gameObjectBuilder}}},7888:(t,e,i)=>{i.d(e,{s:()=>s});class s{constructor(t=null){this.ref=t}}},4394:(t,e,i)=>{i.d(e,{j:()=>a});var s=i(6120),h=i(621);class r{constructor(t,e){this.nh=t,this.ah=e,this.Zi=0,this.uh=0,this.lh=0,this.gh=null,this.Ch=!0}calculateFCost(){this.lh=this.Zi+this.uh}equals(t){return this.nh===t.nh&&this.ah===t.ah}get x(){return this.nh}get y(){return this.ah}get gCost(){return this.Zi}set gCost(t){this.Zi=t}get hCost(){return this.uh}set hCost(t){this.uh=t}get fCost(){return this.lh}set fCost(t){this.lh=t}get isWalkable(){return this.Ch}set isWalkable(t){this.Ch=t}get previousNode(){return this.gh}set previousNode(t){this.gh=t}}class n{constructor(t,e=.5,i=.5,s=1e3){var h;this.mr=null!==(h=null==t?void 0:t.slice())&&void 0!==h?h:[],this.eo=e,this.so=i,this.ho=s}addCollideMap(t){this.mr.push(t)}removeCollideMap(t){const e=this.mr.indexOf(t);e>=0&&this.mr.splice(e,1)}removeAllCollideMaps(){this.mr.length=0}findPath(t,e){const i=new r(t.x,t.y),s=new r(e.x,e.y);if(this.lo(i.x,i.y))return null;if(this.lo(s.x,s.y))return null;const h=[],n=[];i.gCost=0,i.hCost=this.ao(i,s),i.calculateFCost(),h.push(i);let o=0;for(;h.length>0&&o<this.ho;){o++;const t=this.co(h);if(t.equals(s))return this.uo(t);h.splice(h.indexOf(t),1),n.push(t);const e=this.do(t);for(let i=0;i<e.length;++i){const r=e[i];if(void 0!==n.find((t=>t.equals(r))))continue;if(r.gCost=Number.MAX_VALUE,r.calculateFCost(),r.previousNode=null,this.lo(r.x,r.y)){n.push(r);continue}const o=t.gCost+this.ao(t,r);o<r.gCost&&(r.previousNode=t,r.gCost=o,r.hCost=this.ao(r,s),r.calculateFCost(),void 0===h.find((t=>t.equals(r)))&&h.push(r))}}return null}do(t){const e=[];return e.push(new r(t.x,t.y-1)),e.push(new r(t.x+1,t.y)),e.push(new r(t.x,t.y+1)),e.push(new r(t.x-1,t.y)),e}uo(t){const e=[];let i=t;for(;i.previousNode;)e.push(new s.F(i.x,i.y)),i=i.previousNode;return e.push(new s.F(i.x,i.y)),e.reverse()}ao(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}co(t){let e=t[0];for(let i=1;i<t.length;++i)t[i].fCost<e.fCost&&(e=t[i]);return e}lo(t,e){const i=this.mr;for(let s=0;s<i.length;++s){const h=i[s];if(h.checkCollision(t*h.gridCellWidth+h.gridCenterX,e*h.gridCellHeight+h.gridCenterY,this.eo,this.so))return!0}return!1}}var o=i(274);class a extends o.T{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Ph=8,this.Th=1,this.Ih=1,this.mr=[],this.Gh=.5,this.Lh=new s.F,this.Rh=new s.F,this.Uh=new s.F,this.Hh=new s.F,this.Kh=new h.n,this.Oh=new h.n,this.gr=null,this.wr=null,this.Wh=!1,this.Fh=null,this.qh=0,this.Jh=null,this.Nh=new s.F,this.Qh=!0,this.Xh=new s.F,this.Yh=-1,this.Zh=new s.F,this.$h=.3,this._r=t=>{if(0!==t.button)return;this.Wh=!1;const e=this.engine.time.unscaledTime;e-this.Yh<this.$h?this.Zh.equals(t.gridPosition)&&(this.Dr(t),this.Yh=-1):(this.Yh=e,this.Zh.copy(t.gridPosition))}}start(){this.wr=new n(this.mr,this.Ih*this.Gh,this.Th*this.Gh);const t=this.transform,e=t.position;e.x=this.Lh.x+this.Hh.x*this.Ih,e.y=this.Lh.y+this.Hh.y*this.Th,this.Rh.set(t.localPosition.x,t.localPosition.y);const i=t.parent;i&&this.Nh.set(i.position.x,i.position.y)}update(){var t;null===(t=this.Jh)||void 0===t||t.call(this),this.Qh&&this.Mr(),this.Ar(),this.Vr()}Mr(){if(this.isMoving)return void this.Tr();const t=this.engine.input.map;if(t.get("w")||t.get("ArrowUp")){if(this.direction=o.N.Up,this.lo(this.Rh.x,this.Rh.y+this.Th))return;this.Uh.set(this.Rh.x,this.Rh.y+this.Th),this.Ir(),this.isMoving=!0}else if(t.get("s")||t.get("ArrowDown")){if(this.direction=o.N.Down,this.lo(this.Rh.x,this.Rh.y-this.Th))return;this.Uh.set(this.Rh.x,this.Rh.y-this.Th),this.Ir(),this.isMoving=!0}else if(t.get("a")||t.get("ArrowLeft")){if(this.direction=o.N.Left,this.lo(this.Rh.x-this.Ih,this.Rh.y))return;this.Uh.set(this.Rh.x-this.Ih,this.Rh.y),this.Ir(),this.isMoving=!0}else if(t.get("d")||t.get("ArrowRight")){if(this.direction=o.N.Right,this.lo(this.Rh.x+this.Ih,this.Rh.y))return;this.Uh.set(this.Rh.x+this.Ih,this.Rh.y),this.Ir(),this.isMoving=!0}}kr(t){const e=this.engine.input.map;return e.get("w")||e.get("ArrowUp")?(this.direction=o.N.Up,!this.lo(t.x,t.y+this.Th)&&(this.Uh.set(t.x,t.y+this.Th),this.Ir(),!0)):e.get("s")||e.get("ArrowDown")?(this.direction=o.N.Down,!this.lo(t.x,t.y-this.Th)&&(this.Uh.set(t.x,t.y-this.Th),this.Ir(),!0)):e.get("a")||e.get("ArrowLeft")?(this.direction=o.N.Left,!this.lo(t.x-this.Ih,t.y)&&(this.Uh.set(t.x-this.Ih,t.y),this.Ir(),!0)):!(!e.get("d")&&!e.get("ArrowRight"))&&(this.direction=o.N.Right,!this.lo(t.x+this.Ih,t.y)&&(this.Uh.set(t.x+this.Ih,t.y),this.Ir(),!0))}Ir(){this.Kh.invoke(Math.floor(this.Uh.x/this.Ih),Math.floor(this.Uh.y/this.Th))}Er(){this.Oh.invoke(Math.floor(this.Rh.x/this.Ih),Math.floor(this.Rh.y/this.Th))}Tr(){const t=this.engine.input.map;(t.get("w")||t.get("ArrowUp")||t.get("s")||t.get("ArrowDown")||t.get("a")||t.get("ArrowLeft")||t.get("d")||t.get("ArrowRight"))&&(this.Wh=!1)}Ar(){if(!this.Wh)return;const t=this.transform,e=this.Xh.set(t.localPosition.x,t.localPosition.y),i=this.Fh[this.qh];if(i.distanceTo(e)<this.Ph*this.engine.time.deltaTime){if(this.qh++,this.qh>=this.Fh.length)return void(this.Wh=!1);this.Er()}if(this.lo(i.x,i.y))return void(this.Wh=!1);if(this.Uh.equals(this.Fh[this.qh]))return;this.Uh.copy(this.Fh[this.qh]),this.Ir();const s=this.Fh[this.qh-1].x,h=this.Fh[this.qh-1].y,r=this.Fh[this.qh].x,n=this.Fh[this.qh].y;h<n?this.direction=o.N.Up:h>n?this.direction=o.N.Down:s<r?this.direction=o.N.Right:s>r&&(this.direction=o.N.Left),this.isMoving=!0}Vr(){if(!this.isMoving)return;const t=this.transform,e=new s.F(t.localPosition.x,t.localPosition.y);let i=e.distanceTo(this.Uh);if(i<this.Ph*this.engine.time.deltaTime&&this.kr(this.Uh)&&(i=e.distanceTo(this.Uh),this.Er()),i>.01){const s=this.Xh.copy(this.Uh).sub(e).normalize();s.multiplyScalar(Math.min(this.Ph*this.engine.time.deltaTime,i)),t.localPosition.x+=s.x,t.localPosition.y+=s.y}else this.isMoving=!1,this.Rh.copy(this.Uh),t.localPosition.x=this.Rh.x,t.localPosition.y=this.Rh.y,this.Er()}lo(t,e){t+=this.Nh.x,e+=this.Nh.y;const i=this.mr;for(let s=0;s<i.length;++s)if(i[s].checkCollision(t,e,this.Gh,this.Gh))return!0;return!1}Dr(t){if(this.Wh)return this.Wh=!1,void(this.Jh=()=>{this.tryStartPathfind(t.gridPosition)});this.Jh=()=>{this.tryStartPathfind(t.gridPosition)}}tryStartPathfind(t){if(this.Wh)return!1;this.Jh=null;const e=this.Fh=this.wr.findPath(this.positionInGrid,t);if(!e||e.length<=1)return!1;for(let i=0;i<e.length;++i){const t=e[i];t.x=t.x*this.Ih+this.Lh.x,t.y=t.y*this.Th+this.Lh.y}return this.qh=1,this.isMoving=!0,this.Wh=!0,!0}cancelPathfind(){this.Wh=!1}get onMoveToTarget(){return this.Kh}get onMovedToTarget(){return this.Oh}teleport(t){this.isMoving=!1,this.Wh=!1,this.Uh.copy(t),this.Rh.copy(t),this.transform.localPosition.x=this.Rh.x,this.transform.localPosition.y=this.Rh.y,this.Ir(),this.Er()}get speed(){return this.Ph}set speed(t){this.Ph=t}get gridCenter(){return this.Lh}set gridCenter(t){this.Lh.copy(t)}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}set initPosition(t){this.Hh.copy(t)}set gridPointer(t){this.gr&&this.gr.onPointerDown.removeListener(this._r),this.gr=t,this.gr&&this.gr.onPointerDown.addListener(this._r)}get gridPointer(){return this.gr}addCollideMap(t){var e;this.mr.push(t),null===(e=this.wr)||void 0===e||e.addCollideMap(t)}removeCollideMap(t){var e;const i=this.mr.indexOf(t);i>=0&&(this.mr.splice(i,1),null===(e=this.wr)||void 0===e||e.removeCollideMap(t))}removeAllCollideMaps(){var t;this.mr.length=0,null===(t=this.wr)||void 0===t||t.removeAllCollideMaps()}setGridInfoFromCollideMap(t){this.Ih=t.gridCellWidth,this.Th=t.gridCellHeight,this.Lh.set(t.gridCenterX,t.gridCenterY)}get positionInGrid(){return new s.F(Math.floor(this.transform.localPosition.x/this.Ih),Math.floor(this.transform.localPosition.y/this.Th))}get receiveKeyboardInput(){return this.Qh}set receiveKeyboardInput(t){this.Qh=t}}},7421:(t,e,i)=>{i.d(e,{K:()=>a});var s=i(6120),h=i(4532),r=i(9542),n=i(3674),o=i(6896);class a extends n.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[o.V],this.Ur=null,this.Or=new s.F,this.Lr=20,this.jr=1,this.qr=!1,this.zr=!1,this.Br=6,this.Fr=new h.P}start(){if(this.Ur){const t=this.Fr.copy(this.Ur.transform.position);t.z+=this.Lr,this.transform.position.copy(t)}}update(){const t=this.Fr.copy(this.Ur.transform.position);t.z+=this.Lr,t.x+=this.Or.x,t.y+=this.Or.y;const e=this.transform;if(this.zr){const i=this.engine.time.deltaTime,s=this.Br,h=r.u1(e.position.x,t.x,s,i),n=r.u1(e.position.y,t.y,s,i),o=r.u1(e.position.z,t.z,s,i);e.position.set(h,n,o)}else e.position.copy(t);this.qr&&(e.localPosition.x=Math.round(e.localPosition.x/this.jr)*this.jr,e.localPosition.y=Math.round(e.localPosition.y/this.jr)*this.jr)}setTrackTarget(t){this.Ur=t}get targetOffset(){return this.Or}set targetOffset(t){this.Or.copy(t)}get cameraDistanceOffset(){return this.Lr}set cameraDistanceOffset(t){this.Lr=t}get pixelPerfectUnit(){return this.jr}set pixelPerfectUnit(t){this.jr=t}get pixelPerfect(){return this.qr}set pixelPerfect(t){this.qr=t}get smoothTrack(){return this.zr}set smoothTrack(t){this.zr=t}get smoothLambda(){return this.Br}set smoothLambda(t){this.Br=t}}},274:(t,e,i)=>{i.d(e,{N:()=>s,T:()=>n});var s,h,r=i(3674);(h=s||(s={}))[h.Up=0]="Up",h[h.Down=1]="Down",h[h.Left=2]="Left",h[h.Right=3]="Right";class n extends r.w{constructor(){super(...arguments),this.xo=s.Down,this.Lo=!1}get direction(){return this.xo}set direction(t){this.xo=t}get isMoving(){return this.Lo}set isMoving(t){this.Lo=t}}}}]);