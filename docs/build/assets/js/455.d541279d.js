"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[455],{546:(t,i,s)=>{s.d(i,{W:()=>h});var e=s(8018);class h{constructor(t,i,s,h,r){this._instantiater=t.instantiater,this._gameObjectBuilder=new e.f(t,i,s,h,r)}get instantiater(){return this._instantiater}get gameObjectBuilder(){return this._gameObjectBuilder}}},9672:(t,i,s)=>{s.d(i,{q:()=>n});var e=s(3674),h=s(274),r=s(4286);class n extends e.w{constructor(){super(...arguments),this._disallowMultipleComponent=!0,this._requiredComponents=[h.T,r.h],this.Dh=null,this.Ah=null,this.kh=h.N.Down,this.yh=!1}awake(){this.Dh=this.gameObject.getComponent(h.T),this.Ah=this.gameObject.getComponent(r.h)}update(){const t=this.Dh.direction,i=this.Dh.isMoving;i?t===h.N.Up?this.yh===i&&this.kh===t||(this.Ah.playAnimation("up_walk"),this.yh=i,this.kh=t):t===h.N.Down?this.yh===i&&this.kh===t||(this.Ah.playAnimation("down_walk"),this.yh=i,this.kh=t):t===h.N.Left?this.yh===i&&this.kh===t||(this.Ah.playAnimation("left_walk"),this.yh=i,this.kh=t):t===h.N.Right&&(this.yh===i&&this.kh===t||(this.Ah.playAnimation("right_walk"),this.yh=i,this.kh=t)):t===h.N.Up?this.yh===i&&this.kh===t||(this.Ah.playAnimation("up_idle"),this.yh=i,this.kh=t):t===h.N.Down?this.yh===i&&this.kh===t||(this.Ah.playAnimation("down_idle"),this.yh=i,this.kh=t):t===h.N.Left?this.yh===i&&this.kh===t||(this.Ah.playAnimation("left_idle"),this.yh=i,this.kh=t):t===h.N.Right&&(this.yh===i&&this.kh===t||(this.Ah.playAnimation("right_idle"),this.yh=i,this.kh=t))}}},4394:(t,i,s)=>{s.d(i,{j:()=>l});var e=s(6120),h=s(621);class r{constructor(t,i){this.nh=t,this.ah=i,this.Zi=0,this.uh=0,this.lh=0,this.gh=null,this.Ch=!0}calculateFCost(){this.lh=this.Zi+this.uh}equals(t){return this.nh===t.nh&&this.ah===t.ah}get x(){return this.nh}get y(){return this.ah}get gCost(){return this.Zi}set gCost(t){this.Zi=t}get hCost(){return this.uh}set hCost(t){this.uh=t}get fCost(){return this.lh}set fCost(t){this.lh=t}get isWalkable(){return this.Ch}set isWalkable(t){this.Ch=t}get previousNode(){return this.gh}set previousNode(t){this.gh=t}}class n{constructor(t,i=.5,s=.5,e=1e3){var h;this.mr=null!==(h=null==t?void 0:t.slice())&&void 0!==h?h:[],this.eo=i,this.so=s,this.ho=e}addCollideMap(t){this.mr.push(t)}removeCollideMap(t){const i=this.mr.indexOf(t);i>=0&&this.mr.splice(i,1)}removeAllCollideMaps(){this.mr.length=0}findPath(t,i){const s=new r(t.x,t.y),e=new r(i.x,i.y);if(this.lo(s.x,s.y))return null;if(this.lo(e.x,e.y))return null;const h=[],n=[];s.gCost=0,s.hCost=this.ao(s,e),s.calculateFCost(),h.push(s);let o=0;for(;h.length>0&&o<this.ho;){o++;const t=this.co(h);if(t.equals(e))return this.uo(t);h.splice(h.indexOf(t),1),n.push(t);const i=this.do(t);for(let s=0;s<i.length;++s){const r=i[s];if(void 0!==n.find((t=>t.equals(r))))continue;if(r.gCost=Number.MAX_VALUE,r.calculateFCost(),r.previousNode=null,this.lo(r.x,r.y)){n.push(r);continue}const o=t.gCost+this.ao(t,r);o<r.gCost&&(r.previousNode=t,r.gCost=o,r.hCost=this.ao(r,e),r.calculateFCost(),void 0===h.find((t=>t.equals(r)))&&h.push(r))}}return null}do(t){const i=[];return i.push(new r(t.x,t.y-1)),i.push(new r(t.x+1,t.y)),i.push(new r(t.x,t.y+1)),i.push(new r(t.x-1,t.y)),i}uo(t){const i=[];let s=t;for(;s.previousNode;)i.push(new e.F(s.x,s.y)),s=s.previousNode;return i.push(new e.F(s.x,s.y)),i.reverse()}ao(t,i){return Math.abs(t.x-i.x)+Math.abs(t.y-i.y)}co(t){let i=t[0];for(let s=1;s<t.length;++s)t[s].fCost<i.fCost&&(i=t[s]);return i}lo(t,i){const s=this.mr;for(let e=0;e<s.length;++e){const h=s[e];if(h.checkCollision(t*h.gridCellWidth+h.gridCenterX,i*h.gridCellHeight+h.gridCenterY,this.eo,this.so))return!0}return!1}}var o=s(274);class l extends o.T{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Ph=8,this.Th=1,this.Ih=1,this.mr=[],this.Gh=.5,this.Lh=new e.F,this.Rh=new e.F,this.Uh=new e.F,this.Hh=new e.F,this.Kh=new h.n,this.Oh=new h.n,this.gr=null,this.wr=null,this.Wh=!1,this.Fh=null,this.qh=0,this.Jh=null,this.Nh=new e.F,this.Qh=!0,this.Xh=new e.F,this.Yh=-1,this.Zh=new e.F,this.$h=.3,this._r=t=>{if(0!==t.button)return;this.Wh=!1;const i=this.engine.time.unscaledTime;i-this.Yh<this.$h?this.Zh.equals(t.gridPosition)&&(this.Dr(t),this.Yh=-1):(this.Yh=i,this.Zh.copy(t.gridPosition))}}start(){this.wr=new n(this.mr,this.Ih*this.Gh,this.Th*this.Gh);const t=this.transform,i=t.position;i.x=this.Lh.x+this.Hh.x*this.Ih,i.y=this.Lh.y+this.Hh.y*this.Th,this.Rh.set(t.localPosition.x,t.localPosition.y);const s=t.parent;s&&this.Nh.set(s.position.x,s.position.y)}update(){var t;null===(t=this.Jh)||void 0===t||t.call(this),this.Qh&&this.Mr(),this.Ar(),this.Vr()}Mr(){if(this.isMoving)return void this.Tr();const t=this.engine.input.map;if(t.get("w")||t.get("ArrowUp")){if(this.direction=o.N.Up,this.lo(this.Rh.x,this.Rh.y+this.Th))return;this.Uh.set(this.Rh.x,this.Rh.y+this.Th),this.Ir(),this.isMoving=!0}else if(t.get("s")||t.get("ArrowDown")){if(this.direction=o.N.Down,this.lo(this.Rh.x,this.Rh.y-this.Th))return;this.Uh.set(this.Rh.x,this.Rh.y-this.Th),this.Ir(),this.isMoving=!0}else if(t.get("a")||t.get("ArrowLeft")){if(this.direction=o.N.Left,this.lo(this.Rh.x-this.Ih,this.Rh.y))return;this.Uh.set(this.Rh.x-this.Ih,this.Rh.y),this.Ir(),this.isMoving=!0}else if(t.get("d")||t.get("ArrowRight")){if(this.direction=o.N.Right,this.lo(this.Rh.x+this.Ih,this.Rh.y))return;this.Uh.set(this.Rh.x+this.Ih,this.Rh.y),this.Ir(),this.isMoving=!0}}kr(t){const i=this.engine.input.map;return i.get("w")||i.get("ArrowUp")?(this.direction=o.N.Up,!this.lo(t.x,t.y+this.Th)&&(this.Uh.set(t.x,t.y+this.Th),this.Ir(),!0)):i.get("s")||i.get("ArrowDown")?(this.direction=o.N.Down,!this.lo(t.x,t.y-this.Th)&&(this.Uh.set(t.x,t.y-this.Th),this.Ir(),!0)):i.get("a")||i.get("ArrowLeft")?(this.direction=o.N.Left,!this.lo(t.x-this.Ih,t.y)&&(this.Uh.set(t.x-this.Ih,t.y),this.Ir(),!0)):!(!i.get("d")&&!i.get("ArrowRight"))&&(this.direction=o.N.Right,!this.lo(t.x+this.Ih,t.y)&&(this.Uh.set(t.x+this.Ih,t.y),this.Ir(),!0))}Ir(){this.Kh.invoke(Math.floor(this.Uh.x/this.Ih),Math.floor(this.Uh.y/this.Th))}Er(){this.Oh.invoke(Math.floor(this.Rh.x/this.Ih),Math.floor(this.Rh.y/this.Th))}Tr(){const t=this.engine.input.map;(t.get("w")||t.get("ArrowUp")||t.get("s")||t.get("ArrowDown")||t.get("a")||t.get("ArrowLeft")||t.get("d")||t.get("ArrowRight"))&&(this.Wh=!1)}Ar(){if(!this.Wh)return;const t=this.transform,i=this.Xh.set(t.localPosition.x,t.localPosition.y),s=this.Fh[this.qh];if(s.distanceTo(i)<this.Ph*this.engine.time.deltaTime){if(this.qh++,this.qh>=this.Fh.length)return void(this.Wh=!1);this.Er()}if(this.lo(s.x,s.y))return void(this.Wh=!1);if(this.Uh.equals(this.Fh[this.qh]))return;this.Uh.copy(this.Fh[this.qh]),this.Ir();const e=this.Fh[this.qh-1].x,h=this.Fh[this.qh-1].y,r=this.Fh[this.qh].x,n=this.Fh[this.qh].y;h<n?this.direction=o.N.Up:h>n?this.direction=o.N.Down:e<r?this.direction=o.N.Right:e>r&&(this.direction=o.N.Left),this.isMoving=!0}Vr(){if(!this.isMoving)return;const t=this.transform,i=new e.F(t.localPosition.x,t.localPosition.y);let s=i.distanceTo(this.Uh);if(s<this.Ph*this.engine.time.deltaTime&&this.kr(this.Uh)&&(s=i.distanceTo(this.Uh),this.Er()),s>.01){const e=this.Xh.copy(this.Uh).sub(i).normalize();e.multiplyScalar(Math.min(this.Ph*this.engine.time.deltaTime,s)),t.localPosition.x+=e.x,t.localPosition.y+=e.y}else this.isMoving=!1,this.Rh.copy(this.Uh),t.localPosition.x=this.Rh.x,t.localPosition.y=this.Rh.y,this.Er()}lo(t,i){t+=this.Nh.x,i+=this.Nh.y;const s=this.mr;for(let e=0;e<s.length;++e)if(s[e].checkCollision(t,i,this.Gh,this.Gh))return!0;return!1}Dr(t){if(this.Wh)return this.Wh=!1,void(this.Jh=()=>{this.tryStartPathfind(t.gridPosition)});this.Jh=()=>{this.tryStartPathfind(t.gridPosition)}}tryStartPathfind(t){if(this.Wh)return!1;this.Jh=null;const i=this.Fh=this.wr.findPath(this.positionInGrid,t);if(!i||i.length<=1)return!1;for(let s=0;s<i.length;++s){const t=i[s];t.x=t.x*this.Ih+this.Lh.x,t.y=t.y*this.Th+this.Lh.y}return this.qh=1,this.isMoving=!0,this.Wh=!0,!0}cancelPathfind(){this.Wh=!1}get onMoveToTarget(){return this.Kh}get onMovedToTarget(){return this.Oh}teleport(t){this.isMoving=!1,this.Wh=!1,this.Uh.copy(t),this.Rh.copy(t),this.transform.localPosition.x=this.Rh.x,this.transform.localPosition.y=this.Rh.y,this.Ir(),this.Er()}get speed(){return this.Ph}set speed(t){this.Ph=t}get gridCenter(){return this.Lh}set gridCenter(t){this.Lh.copy(t)}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}set initPosition(t){this.Hh.copy(t)}set gridPointer(t){this.gr&&this.gr.onPointerDown.removeListener(this._r),this.gr=t,this.gr&&this.gr.onPointerDown.addListener(this._r)}get gridPointer(){return this.gr}addCollideMap(t){var i;this.mr.push(t),null===(i=this.wr)||void 0===i||i.addCollideMap(t)}removeCollideMap(t){var i;const s=this.mr.indexOf(t);s>=0&&(this.mr.splice(s,1),null===(i=this.wr)||void 0===i||i.removeCollideMap(t))}removeAllCollideMaps(){var t;this.mr.length=0,null===(t=this.wr)||void 0===t||t.removeAllCollideMaps()}setGridInfoFromCollideMap(t){this.Ih=t.gridCellWidth,this.Th=t.gridCellHeight,this.Lh.set(t.gridCenterX,t.gridCenterY)}get positionInGrid(){return new e.F(Math.floor(this.transform.localPosition.x/this.Ih),Math.floor(this.transform.localPosition.y/this.Th))}get receiveKeyboardInput(){return this.Qh}set receiveKeyboardInput(t){this.Qh=t}}},7421:(t,i,s)=>{s.d(i,{K:()=>l});var e=s(6120),h=s(4532),r=s(9542),n=s(3674),o=s(6896);class l extends n.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[o.V],this.Ur=null,this.Or=new e.F,this.Lr=20,this.jr=1,this.qr=!1,this.zr=!1,this.Br=6,this.Fr=new h.P}start(){if(this.Ur){const t=this.Fr.copy(this.Ur.transform.position);t.z+=this.Lr,this.transform.position.copy(t)}}update(){const t=this.Fr.copy(this.Ur.transform.position);t.z+=this.Lr,t.x+=this.Or.x,t.y+=this.Or.y;const i=this.transform;if(this.zr){const s=this.engine.time.deltaTime,e=this.Br,h=r.u1(i.position.x,t.x,e,s),n=r.u1(i.position.y,t.y,e,s),o=r.u1(i.position.z,t.z,e,s);i.position.set(h,n,o)}else i.position.copy(t);this.qr&&(i.localPosition.x=Math.round(i.localPosition.x/this.jr)*this.jr,i.localPosition.y=Math.round(i.localPosition.y/this.jr)*this.jr)}setTrackTarget(t){this.Ur=t}get targetOffset(){return this.Or}set targetOffset(t){this.Or.copy(t)}get cameraDistanceOffset(){return this.Lr}set cameraDistanceOffset(t){this.Lr=t}get pixelPerfectUnit(){return this.jr}set pixelPerfectUnit(t){this.jr=t}get pixelPerfect(){return this.qr}set pixelPerfect(t){this.qr=t}get smoothTrack(){return this.zr}set smoothTrack(t){this.zr=t}get smoothLambda(){return this.Br}set smoothLambda(t){this.Br=t}}},9558:(t,i,s)=>{s.d(i,{F:()=>o});var e=s(4532),h=s(6120),r=s(3674),n=s(8788);class o extends r.w{constructor(){super(...arguments),this.$r=new Map,this.Ih=1,this.Th=1,this.Rr=!1,this.Sr=[],this.Hr=[],this.Wr=!1}start(){this.Wr=!0;const t=this.Hr;for(let i=0;i<t.length;++i)t[i]();t.length=0}addEvent(t,i,s){this.Wr?(this.$r.set(`${t}_${i}`,s),this.Rr&&this.br(t*this.gridCellWidth,i*this.gridCellHeight)):this.Hr.push((()=>{this.addEvent(t,i,s)}))}addEventsFromTwoDimensionalArray(t,i,s){if(this.Wr)for(let e=0;e<t.length;e++)for(let h=0;h<t[e].length;h++)null!==t[e][h]&&this.addEvent(h+i,t.length-(e+s),t[e][h]);else this.Hr.push((()=>{this.addEventsFromTwoDimensionalArray(t,i,s)}))}Gr(){this.$r.forEach(((t,i)=>{const[s,e]=i.split("_").map(Number);this.br(s*this.gridCellWidth,e*this.gridCellHeight)}))}Nr(){const t=this.Sr;for(let i=0;i<t.length;++i)t[i].destroy();this.Sr.length=0}br(t,i){const s={ref:null};this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debug-image",new e.P(t,i,1e4)).withComponent(n._,(t=>{t.opacity=.5,t.imageWidth=this.gridCellWidth,t.imageHeight=this.gridCellHeight})).getGameObject(s)),this.Sr.push(s.ref)}tryInvokeEvent(t,i,s,e,h){const r=this.transform.position;t-=r.x,i-=r.y;const n=Math.floor(t/this.gridCellWidth),o=Math.floor((t+s)/this.gridCellWidth),l=Math.floor(i/this.gridCellHeight),a=Math.floor((i+e)/this.gridCellHeight);let d=!1;for(let u=l;u<=a;u++)for(let t=n;t<=o;t++)this.$r.has(`${t}_${u}`)&&(this.$r.get(`${t}_${u}`)(t,u,h),d=!0);return d}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get showEvents(){return this.Rr}set showEvents(t){this.Rr=t,this.Rr?this.Gr():this.Nr()}get gridCenter(){const t=this.transform.position;return new h.F(t.x,t.y)}get gridCenterX(){return this.transform.position.x}get gridCenterY(){return this.transform.position.y}}},4149:(t,i,s)=>{s.d(i,{V:()=>r});var e=s(3674),h=s(4394);class r extends e.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[h.j],this.Gh=.5,this.mo=null,this.vo=[],this.po=(t,i)=>{const s=this.mo.gridCenter,e=this.mo.gridCellWidth,h=this.mo.gridCellHeight,r=s.x+t*e,n=s.y+i*h,o=this.vo;for(let l=0;l<o.length;++l)o[l].tryInvokeEvent(r,n,this.Gh,this.Gh,this.gameObject)}}awake(){this.mo=this.gameObject.getComponent(h.j),this.mo.onMoveToTarget.addListener(this.po)}onDestroy(){this.mo.onMoveToTarget.removeListener(this.po)}addGridEventMap(t){this.vo.push(t)}removeGridEventMap(t){const i=this.vo.indexOf(t);i>=0&&this.vo.splice(i,1)}removeAllGridEventMap(){this.vo.length=0}get collideSize(){return this.Gh}set collideSize(t){this.Gh=t}}},5216:(t,i,s)=>{s.d(i,{F:()=>d});var e=s(6120),h=s(4532),r=s(3674),n=s(8788),o=s(3379),l=s(6868);class a extends l.N{constructor(){super(...arguments),this.pn=new Map,this.hn=!1}onEnable(){super.onEnable(),this.hn=!0}onDisable(){super.onDisable(),this.hn=!1}drawTile(t,i,s,e){super.drawTile(t,i,s,e);const h=Math.ceil(t-this.columnCount/2),r=Math.ceil(this.rowCount-i-this.rowCount/2)-1;this.pn.set(`${h}_${r}`,!0)}drawTileFromTwoDimensionalArray(t,i,s){super.drawTileFromTwoDimensionalArray(t,i,s);for(let e=0;e<t.length;e++)for(let h=0;h<t[e].length;h++)if(null!==t[e][h]){const t=Math.ceil(this.transform.localPosition.x/this.gridCellWidth+(h+i)-this.columnCount/2),r=Math.ceil(this.transform.localPosition.y/this.gridCellHeight+(this.rowCount-(e+s))-this.rowCount/2)-1;this.pn.set(`${t}_${r}`,!0)}}clearTile(t,i){super.clearTile(t,i);const s=Math.ceil(t-this.columnCount/2),e=Math.ceil(this.rowCount-i-this.rowCount/2)-1;this.pn.delete(`${s}_${e}`)}addCollider(t,i){const s=Math.ceil(t-this.columnCount/2),e=Math.ceil(this.rowCount-i-this.rowCount/2)-1;this.pn.set(`${s}_${e}`,!0)}checkCollision(t,i,s,e){if(!this.hn)return!1;const h=this.transform.position;t-=h.x,i-=h.y,this.columnCount%2==0&&(t-=this.gridCellWidth),this.rowCount%2==0&&(i-=this.gridCellHeight),this.rowCount%2==0&&(i+=this.gridCellHeight/2),this.columnCount%2==0&&(t+=this.gridCellWidth/2);const r=Math.floor(t/this.gridCellWidth),n=Math.floor((t+s)/this.gridCellWidth),o=Math.floor(i/this.gridCellHeight),l=Math.floor((i+e)/this.gridCellHeight);for(let a=o;a<=l;a++)for(let t=r;t<=n;t++)if(!0===this.pn.get(`${t}_${a}`))return!0;return!1}}class d extends r.w{constructor(){super(...arguments),this.Xr=new Map,this.Yr=16,this.Kr=1,this.Jr=1,this.Qr=16,this.Zr=16,this.tn=1.001,this.sn=null,this.en=!0,this.hn=!1,this.rn=.1,this.nn=n.r.Pixelated,this.on=()=>{this.Xr.forEach(((t,i)=>{t.filter.copy(this.Ui)}))},this.Ui=new o.c(this.on),this.Hr=[],this.Wr=!1}start(){this.Wr=!0;const t=this.Hr;for(let i=0;i<t.length;++i)t[i]();t.length=0}onEnable(){this.hn=!0}onDisable(){this.hn=!1}ln(){this.Xr.forEach(((t,i)=>{const s=this.cn(i)*this.Yr*this.Kr,e=this.un(i)*this.Yr*this.Jr;t.gameObject.transform.localPosition.set(s,e,0)}))}cn(t){return parseInt(t.substring(0,t.indexOf("_")))}un(t){return parseInt(t.substring(t.indexOf("_")+1))}an(t,i){return`${t}_${i}`}dn(t,i,s,h){const r=s-t*this.Yr+this.Yr/2,n=h-i*this.Yr+this.Yr/2;return new e.F(r,n)}fn(t,i){const s=this.an(t,i);let e=this.Xr.get(s);return void 0===e&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject(`css_tilemap_renderer_${t}_${i}`,new h.P(t*this.Yr*this.Kr,i*this.Yr*this.Jr,0),void 0,(new h.P).setScalar(this.tn)).withComponent(a,(t=>{e=t,this.sn&&(t.imageSources=this.sn),t.gridCellWidth=this.Kr,t.gridCellHeight=this.Jr,t.tileResolutionX=this.Qr,t.tileResolutionY=this.Zr,t.rowCount=this.Yr,t.columnCount=this.Yr,t.pointerEvents=this.en,t.viewScale=this.rn,t.filter.copy(this.Ui)}))),this.Xr.set(s,e)),e}gn(t,i){const s=this.an(t,i),e=this.Xr.get(s);return void 0===e?null:e}drawTile(t,i,s,e){if(!this.Wr)return void this.Hr.push((()=>{this.drawTile(t,i,s,e)}));const h=Math.floor((t+this.Yr/2)/this.Yr),r=Math.floor((i+this.Yr/2)/this.Yr),n=this.fn(h,r),o=this.dn(h,r,t,i),l=this.chunkSize%2==0?0:-.5,a=this.chunkSize%2==0?0:.5;n.drawTile(o.x+l,this.Yr-o.y-1+a,s,e)}drawTileFromTwoDimensionalArray(t,i,s){if(this.Wr)for(let e=0;e<t.length;e++)for(let h=0;h<t[e].length;h++)null!==t[e][h]&&this.drawTile(h+i,t.length-e+s-1,t[e][h].i,t[e][h].a);else this.Hr.push((()=>{this.drawTileFromTwoDimensionalArray(t,i,s)}))}clearTile(t,i){if(!this.Wr)return void this.Hr.push((()=>{this.clearTile(t,i)}));const s=Math.floor((t+this.Yr/2)/this.Yr),e=Math.floor((i+this.Yr/2)/this.Yr),h=this.gn(s,e);if(null===h)return;const r=this.dn(s,e,t,i),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.clearTile(r.x+n,this.Yr-r.y-1+o)}addCollider(t,i){if(!this.Wr)return void this.Hr.push((()=>{this.addCollider(t,i)}));const s=Math.floor((t+this.Yr/2)/this.Yr),e=Math.floor((i+this.Yr/2)/this.Yr),h=this.fn(s,e),r=this.dn(s,e,t,i),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.addCollider(r.x+n,this.Yr-r.y-1+o)}checkCollision(t,i,s,e){if(!this.hn)return!1;const h=this.transform.position,r=Math.floor(((t-h.x)/this.Kr+this.Yr/2)/this.Yr),n=Math.floor(((i-h.y)/this.Jr+this.Yr/2)/this.Yr),o=this.an(r,n),l=this.Xr.get(o);return void 0!==l&&l.checkCollision(t,i,s,e)}get chunkSize(){return this.Yr}set chunkSize(t){this.Yr=t,this.ln(),this.Xr.forEach(((t,i)=>{t.rowCount=this.Yr,t.columnCount=this.Yr}))}set imageSources(t){this.Wr?this.sn=t:this.Hr.push((()=>{this.imageSources=t}))}get pointerEvents(){return this.en}set pointerEvents(t){this.en=t,this.Xr.forEach(((i,s)=>{i.pointerEvents=t}))}get gridCellWidth(){return this.Kr}set gridCellWidth(t){this.Kr!==t&&(this.Kr=t,this.ln(),this.Xr.forEach(((t,i)=>{t.gridCellWidth=this.Kr})))}get gridCellHeight(){return this.Jr}set gridCellHeight(t){this.Jr!==t&&(this.Jr=t,this.ln(),this.Xr.forEach(((t,i)=>{t.gridCellHeight=this.Jr})))}get tileResolutionX(){return this.Qr}set tileResolutionX(t){this.Qr!==t&&(this.Qr=t,this.Xr.forEach(((t,i)=>{t.tileResolutionX=this.Qr})))}get tileResolutionY(){return this.Zr}set tileResolutionY(t){this.Zr!==t&&(this.Zr=t,this.Xr.forEach(((t,i)=>{t.tileResolutionY=this.Zr})))}get tilemapScale(){return this.tn}set tilemapScale(t){this.tn!==t&&(this.tn=t,this.Xr.forEach(((t,i)=>{t.gameObject.transform.localScale.setScalar(this.tn)})))}get gridCenter(){const t=this.transform.position,i=this.Yr%2==1?0:this.Kr/2,s=this.Yr%2==1?0:this.Jr/2;return new e.F(t.x+i,t.y+s)}get gridCenterX(){const t=this.transform.position,i=this.Yr%2==1?0:this.Kr/2;return t.x+i}get gridCenterY(){const t=this.transform.position,i=this.Yr%2==1?0:this.Jr/2;return t.y+i}get viewScale(){return this.rn}set viewScale(t){this.rn=t,this.Xr.forEach(((t,i)=>{t.viewScale=this.rn}))}get filter(){return this.Ui}get imageRenderingMode(){return this.nn}set imageRenderingMode(t){this.nn=t,this.Xr.forEach(((i,s)=>{i.imageRenderingMode=t}))}}},671:(t,i,s)=>{s.d(i,{r:()=>l});var e=s(4532),h=s(6120),r=s(3674),n=s(7888),o=s(8788);class l extends r.w{constructor(){super(...arguments),this.pn=new Map,this.Ih=1,this.Th=1,this.Rr=!1,this.fo=!1,this.Co=new Map,this.hn=!1,this.Hr=[],this.Wr=!1}start(){this.Wr=!0;const t=this.Hr;for(let i=0;i<t.length;++i)t[i]();this.Hr.length=0}onEnable(){this.Rr&&!this.fo&&(this._o(),this.fo=!0),this.hn=!0}onDisable(){this.$o(),this.fo=!1,this.hn=!1}addCollider(t,i){this.Wr?this.pn.has(`${t}_${i}`)||(this.pn.set(`${t}_${i}`,!0),this.Rr&&this.br(t*this.gridCellWidth,i*this.gridCellHeight)):this.Hr.push((()=>{this.addCollider(t,i)}))}addColliderFromTwoDimensionalArray(t,i,s){if(this.Wr)for(let e=0;e<t.length;e++)for(let h=0;h<t[e].length;h++)1===t[e][h]&&this.addCollider(h+i,t.length-(e+s));else this.Hr.push((()=>{this.addColliderFromTwoDimensionalArray(t,i,s)}))}removeCollider(t,i){this.Wr?(this.pn.delete(`${t}_${i}`),this.Rr&&this.bo(t*this.gridCellWidth,i*this.gridCellHeight)):this.Hr.push((()=>{this.removeCollider(t,i)}))}removeAllColliders(){this.pn.clear(),this.$o()}_o(){this.pn.forEach(((t,i)=>{const[s,e]=i.split("_").map(Number);this.br(s*this.gridCellWidth,e*this.gridCellHeight)}))}$o(){this.Co.forEach((t=>{t.destroy()})),this.Co.clear()}br(t,i){const s=new n.s;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debug-image",new e.P(t,i,41e4)).withComponent(o._,(t=>{t.opacity=.5,t.pointerEvents=!1,t.imageWidth=this.gridCellWidth,t.imageHeight=this.gridCellHeight})).getGameObject(s)),this.Co.set(`${t}_${i}`,s.ref)}bo(t,i){const s=this.Co.get(`${t}_${i}`);s&&(s.destroy(),this.Co.delete(`${t}_${i}`))}checkCollision(t,i,s,e){if(!this.hn)return!1;const h=this.transform.position;t-=h.x,i-=h.y;const r=Math.floor(t/this.gridCellWidth),n=Math.floor((t+s)/this.gridCellWidth),o=Math.floor(i/this.gridCellHeight),l=Math.floor((i+e)/this.gridCellHeight);for(let a=o;a<=l;a++)for(let t=r;t<=n;t++)if(this.pn.get(`${t}_${a}`))return!0;return!1}getCollidersToArray(){const t=[];return this.pn.forEach(((i,s)=>{const[e,r]=s.split("_").map(Number);t.push(new h.F(e,r))})),t}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get showCollider(){return this.Rr}set showCollider(t){this.Rr!==t&&(this.Rr=t,this.Rr&&!this.fo?(this._o(),this.fo=!0):(this.$o(),this.fo=!1))}get gridCenter(){const t=this.transform.position;return new h.F(t.x,t.y)}get gridCenterX(){return this.transform.position.x}get gridCenterY(){return this.transform.position.y}}},2515:(t,i,s)=>{s.d(i,{u:()=>n});var e=s(4532),h=s(3674),r=s(8788);class n extends h.w{constructor(){super(...arguments),this.pn=new Map,this.Mo=!1,this.wo=!1,this.Co=new Map,this.Io=null,this.Do=!1,this.Hr=[],this.Wr=!1}start(){this.Wr=!0;const t=this.Hr;for(let i=0;i<t.length;++i)t[i]();if(this.Hr.length=0,!this.Io)throw new Error("GridCollider: gridObjectCollideMap must be set")}onEnable(){this.Mo&&!this.wo&&(this._o(),this.wo=!0),this.So()}onDisable(){this.Mo&&(this.$o(),this.wo=!1),this.Do&&this.jo()}onDestroy(){this.$o(),this.jo()}addCollider(t,i){this.Wr?this.pn.has(`${t}_${i}`)||(this.pn.set(`${t}_${i}`,!0),this.Mo&&this.br(t,i),this.gridObjectCollideMap&&this.To(t,i)):this.Hr.push((()=>{this.addCollider(t,i)}))}addColliderFromTwoDimensionalArray(t,i,s){if(this.Wr)for(let e=0;e<t.length;e++)for(let h=0;h<t[e].length;h++)1===t[e][h]&&this.addCollider(h+i,t.length-e-1+s);else this.Hr.push((()=>{this.addColliderFromTwoDimensionalArray(t,i,s)}))}removeCollider(t,i){this.Wr?(this.pn.delete(`${t}_${i}`),this.Mo&&this.bo(t,i),this.gridObjectCollideMap&&this.yo(t,i)):this.Hr.push((()=>{this.removeCollider(t,i)}))}_o(){this.pn.forEach(((t,i)=>{const[s,e]=i.split("_").map(Number);this.br(s,e)}))}$o(){this.Co.forEach((t=>{t.destroy()})),this.Co.clear()}br(t,i){if(!this.Io)return;const s=this.Io.gridCellWidth,h=this.Io.gridCellHeight,n=t*s,o=i*h,l={ref:null};this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debug-image",new e.P(n,o,41e4)).withComponent(r._,(t=>{t.opacity=.5,t.imageWidth=s,t.imageHeight=h})).getGameObject(l)),this.Co.set(`${t}_${i}`,l.ref)}bo(t,i){const s=this.Co.get(`${t}_${i}`);s&&(s.destroy(),this.Co.delete(`${t}_${i}`))}To(t,i){if(!this.Io)return;const s=this.transform.position,e=this.Io.gridCellWidth,h=this.Io.gridCellHeight,r=this.Io.gridCenter,n=Math.floor(t+(s.x+r.x)/e),o=Math.floor(i+(s.y+r.y)/h);this.Io.addCollider(n,o)}So(){if(!this.Io)return;const t=this.transform.position,i=this.Io.gridCellWidth,s=this.Io.gridCellHeight,e=this.Io.gridCenter;this.pn.forEach(((h,r)=>{const[n,o]=r.split("_").map(Number),l=Math.floor(n+t.x/i+e.x),a=Math.floor(o+t.y/s+e.y);this.Io.addCollider(l,a)}))}yo(t,i){if(!this.Io)return;const s=this.transform.position,e=this.Io.gridCellWidth,h=this.Io.gridCellHeight,r=this.Io.gridCenter,n=Math.floor(t+(s.x+r.x)/e),o=Math.floor(i+(s.y+r.y)/h);this.Io.removeCollider(n,o)}jo(){if(!this.Io)return;const t=this.transform.position,i=this.Io.gridCellWidth,s=this.Io.gridCellHeight,e=this.Io.gridCenter;this.pn.forEach(((h,r)=>{const[n,o]=r.split("_").map(Number),l=Math.floor(n+(t.x+e.x)/i),a=Math.floor(o+(t.y+e.y)/s);this.Io.removeCollider(l,a)}))}get gridObjectCollideMap(){return this.Io}set gridObjectCollideMap(t){this.Do&&this.jo(),this.Io=t,this.So(),this.Do=!0,this.Io&&this.Mo&&(this.$o(),this._o())}get showCollideSpot(){return this.Mo}set showCollideSpot(t){this.Mo!==t&&(this.Mo=t,this.Mo&&!this.wo?(this._o(),this.wo=!0):(this.$o(),this.wo=!1))}}},2382:(t,i,s)=>{s.d(i,{I:()=>l});var e=s(4532),h=s(6120),r=s(3674),n=s(7888),o=s(8788);class l extends r.w{constructor(){super(...arguments),this.pn=new Map,this.Ih=1,this.Th=1,this.Rr=!1,this.fo=!1,this.Co=new Map,this.hn=!1,this.Hr=[],this.Wr=!1}start(){this.Wr=!0;const t=this.Hr;for(let i=0;i<t.length;++i)t[i]();this.Hr.length=0}onEnable(){this.Rr&&!this.fo&&(this._o(),this.fo=!0),this.hn=!0}onDisable(){this.$o(),this.fo=!1,this.hn=!1}addCollider(t,i){if(!this.Wr)return void this.Hr.push((()=>{this.addCollider(t,i)}));const s=this.pn.get(`${t}_${i}`);this.pn.set(`${t}_${i}`,void 0===s?1:s+1),this.Rr&&this.br(t*this.gridCellWidth,i*this.gridCellHeight)}addColliderFromTwoDimensionalArray(t,i,s){if(this.Wr)for(let e=0;e<t.length;e++)for(let h=0;h<t[e].length;h++)1===t[e][h]&&this.addCollider(h+i,t.length-(e+s));else this.Hr.push((()=>{this.addColliderFromTwoDimensionalArray(t,i,s)}))}removeCollider(t,i){const s=this.pn.get(`${t}_${i}`);void 0!==s&&(1===s?this.pn.delete(`${t}_${i}`):this.pn.set(`${t}_${i}`,s-1),this.Rr&&this.bo(t*this.gridCellWidth,i*this.gridCellHeight))}_o(){this.pn.forEach(((t,i)=>{const[s,e]=i.split("_").map(Number);this.br(s*this.gridCellWidth,e*this.gridCellHeight)}))}$o(){this.Co.forEach((t=>{t.destroy()})),this.Co.clear()}br(t,i){const s=new n.s;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debug-image",new e.P(t,i,41e4)).withComponent(o._,(t=>{t.opacity=.5,t.pointerEvents=!1,t.imageWidth=this.gridCellWidth,t.imageHeight=this.gridCellHeight})).getGameObject(s)),this.Co.set(`${t}_${i}`,s.ref)}bo(t,i){const s=this.Co.get(`${t}_${i}`);s&&(s.destroy(),this.Co.delete(`${t}_${i}`))}checkCollision(t,i,s,e){if(!this.hn)return!1;const h=this.transform.position;t-=h.x,i-=h.y;const r=Math.floor(t/this.gridCellWidth),n=Math.floor((t+s)/this.gridCellWidth),o=Math.floor(i/this.gridCellHeight),l=Math.floor((i+e)/this.gridCellHeight);for(let a=o;a<=l;a++)for(let t=r;t<=n;t++){const i=this.pn.get(`${t}_${a}`);if(void 0!==i&&i>0)return!0}return!1}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get showCollider(){return this.Rr}set showCollider(t){this.Rr!==t&&(this.Rr=t,this.Rr&&!this.fo?(this._o(),this.fo=!0):(this.$o(),this.fo=!1))}get gridCenter(){const t=this.transform.position;return new h.F(t.x,t.y)}get gridCenterX(){return this.transform.position.x}get gridCenterY(){return this.transform.position.y}}},983:(t,i,s)=>{s.d(i,{E:()=>e});class e{static loadImageFromPath(t){return new Promise(((i,s)=>{const e=new Image;e.onload=()=>{i(e)},e.onerror=()=>{s(new Error(`Failed to load image "${t}".`))},e.src=t}))}static loadImagesFromPath(t){return Promise.all(t.map((t=>e.loadImageFromPath(t))))}static loadImage(t){return new Promise(((i,s)=>{t.onload=()=>{i(t)},t.onerror=()=>{s(new Error("Failed to load image."))}}))}static loadImages(t){return Promise.all(t.map((t=>e.loadImage(t))))}}},274:(t,i,s)=>{s.d(i,{N:()=>e,T:()=>n});var e,h,r=s(3674);(h=e||(e={}))[h.Up=0]="Up",h[h.Down=1]="Down",h[h.Left=2]="Left",h[h.Right=3]="Right";class n extends r.w{constructor(){super(...arguments),this.xo=e.Down,this.Lo=!1}get direction(){return this.xo}set direction(t){this.xo=t}get isMoving(){return this.Lo}set isMoving(t){this.Lo=t}}},291:(t,i,s)=>{s.d(i,{d:()=>e});class e{static map(t,i){const s=[];for(let e=0;e<t.length;++e){const h=[],r=t[e];for(let t=0;t<r.length;++t){const s=r[t];if(void 0===i[s])throw new Error(`conversion not found for ${s}`);h.push(i[s](t,e))}s.push(h)}return s}}},9328:(t,i,s)=>{s.d(i,{P:()=>a});var e=s(4532),h=s(621),r=s(3674),n=s(7888),o=s(1466),l=s(6066);class a extends r.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[l.v],this.mn=null,this.vn=0,this.Pn=null,this.Cn=null,this.Is=new h.n,this.Xs=new h.n,this.Gs=new h.n,this.wn=!1,this.Wr=!1,this.En=t=>{this.Pn.activeSelf=!0,this.Dn(t)},this.Rn=t=>{this.wn&&this.bn(t),this.Pn.activeSelf=!1},this.Gn=t=>{var i;this.wn=!0,this.Hn(t);const s=null===(i=this.Cn)||void 0===i?void 0:i.element;s&&(s.style.backgroundColor="#DDDDDD"),this.Is.invoke(t)},this.bn=t=>{var i;this.wn=!1,this.Hn(t);const s=null===(i=this.Cn)||void 0===i?void 0:i.element;s&&(s.style.backgroundColor="white"),this.Xs.invoke(t)},this.Dn=t=>{this.Hn(t),this.Gs.invoke(t)}}start(){this.mn=this.gameObject.getComponent(l.v),this.mn.onPointerEnter.addListener(this.En),this.mn.onPointerLeave.addListener(this.Rn),this.mn.onPointerDown.addListener(this.Gn),this.mn.onPointerUp.addListener(this.bn),this.mn.onPointerMove.addListener(this.Dn);const t=new n.s,i=new n.s;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("pointer",new e.P(0,0,this.vn)).active(!1).withComponent(o.w,(t=>{t.pointerEvents=!1;const i=document.createElement("div");i.style.backgroundColor="white",i.style.opacity="0.3",t.element=i})).getComponent(o.w,i).getGameObject(t)),this.Pn=t.ref,this.Cn=i.ref,this.Wr=!0}onDestroy(){this.Wr&&this.mn&&(this.mn.onPointerEnter.removeListener(this.En),this.mn.onPointerLeave.removeListener(this.Rn),this.mn.onPointerDown.removeListener(this.Gn),this.mn.onPointerUp.removeListener(this.bn),this.mn.onPointerMove.removeListener(this.Dn))}Hn(t){const i=this.mn.gridCellWidth,s=this.mn.gridCellHeight,e=this.mn.gridCenter,h=t.gridPosition.x*i+e.x,r=t.gridPosition.y*s+e.y;this.Pn.transform.localPosition.set(h,r,this.vn)}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerMove(){return this.Gs}get pointerZoffset(){return this.vn}set pointerZoffset(t){this.vn=t}}},6066:(t,i,s)=>{s.d(i,{v:()=>d});var e=s(6120),h=s(4532),r=s(621),n=s(3674),o=s(4627),l=s(6684);class a{constructor(t,i,s){this.xn=new e.F(t.x,t.y),this.Sn=new e.F(i.x,i.y),this.Tn=s}get gridPosition(){return this.xn}get position(){return this.Sn}get button(){return this.Tn}}class d extends n.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Vn=null,this.yn=null,this.Ih=1,this.Th=1,this.Lh=new e.F,this.rn=.1,this.Mn=64,this._n=64,this.Is=new r.n,this.Xs=new r.n,this.Ys=new r.n,this.zs=new r.n,this.Gs=new r.n,this.Zs=null,this.Js=!1,this.Wr=!1,this.Wn=new h.P,this.jn=t=>{const i=this.Kn(t.offsetX,t.offsetY,t.button);this.Is.invoke(i)},this.On=t=>{const i=this.Kn(t.offsetX,t.offsetY,t.button);this.Xs.invoke(i)},this.Fn=t=>{const i=this.Kn(t.offsetX,t.offsetY,t.button);this.Ys.invoke(i)},this.In=t=>{const i=this.Kn(t.offsetX,t.offsetY,t.button);this.zs.invoke(i)},this.Ln=t=>{const i=this.Kn(t.offsetX,t.offsetY,t.button);this.Gs.invoke(i)},this.Un=t=>{this.Zs=()=>{this.be("mouseenter",t.touches[0]),this.be("mousedown",t.touches[0])}},this.Xn=t=>{this.Js&&(this.Js=!1,this.be("mouseup",t.changedTouches[0]),this.be("mouseleave",t.changedTouches[0]))},this.Yn=t=>{this.Zs&&(this.Zs(),this.Zs=null),this.be("mousemove",t.touches[0]),this.Js=!0},this.kn=t=>{this.Js&&(this.Js=!1,this.be("mouseleave",t.changedTouches[0]))}}start(){this.yn=document.createElement("div"),this.Vn=new l.cp(this.yn),this.Vn.scale.setScalar(this.rn),this.yn.style.width=this.Mn/this.rn+"px",this.yn.style.height=this._n/this.rn+"px",this.yn.addEventListener("mousedown",this.jn),this.yn.addEventListener("mouseup",this.On),this.yn.addEventListener("mouseenter",this.Fn),this.yn.addEventListener("mouseleave",this.In),this.yn.addEventListener("mousemove",this.Ln),this.yn.addEventListener("touchstart",this.Un),this.yn.addEventListener("touchend",this.Xn),this.yn.addEventListener("touchmove",this.Yn),this.yn.addEventListener("touchcancel",this.kn),this.transform.unsafeGetObject3D().add(this.Vn),o.w.updateRawObject3DWorldMatrixRecursively(this.Vn),this.transform.enqueueRenderAttachedObject3D(this.Vn),this.Wr=!0}update(){let t;this.Wn.copy(this.engine.cameraContainer.camera.transform.position),t=this.transform.parent?this.transform.parent.inverseTransformPoint(this.Wn):this.Wn,this.Vn.position.x=t.x,this.Vn.position.y=t.y,o.w.updateRawObject3DWorldMatrixRecursively(this.Vn),this.transform.enqueueRenderAttachedObject3D(this.Vn)}onDestroy(){this.Wr&&(this.yn&&(this.yn.removeEventListener("mousedown",this.jn),this.yn.removeEventListener("mouseup",this.On),this.yn.removeEventListener("mouseenter",this.Fn),this.yn.removeEventListener("mouseleave",this.In),this.yn.removeEventListener("mousemove",this.Ln),this.yn.removeEventListener("touchstart",this.Un),this.yn.removeEventListener("touchend",this.Xn),this.yn.removeEventListener("touchmove",this.Yn),this.yn.removeEventListener("touchcancel",this.kn)),this.Vn&&this.transform.unsafeGetObject3D().remove(this.Vn))}onWorldMatrixUpdated(){this.Vn&&(o.w.updateRawObject3DWorldMatrixRecursively(this.Vn),this.transform.enqueueRenderAttachedObject3D(this.Vn))}Kn(t,i,s){t*=this.rn,i*=this.rn;const h=this.transform.position,r=this.Vn.position.x+h.x-this.Mn/2+t-this.Lh.x,n=this.Vn.position.y+h.y-this._n/2+(this._n-i)-this.Lh.y,o=Math.floor((r+.5*this.Ih)/this.Ih),l=Math.floor((n+.5*this.Th)/this.Th);return new a(new e.F(o,l),new e.F(r,n),s)}be(t,i){const s=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});i.target.dispatchEvent(s)}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerEnter(){return this.Ys}get onPointerLeave(){return this.zs}get onPointerMove(){return this.Gs}get gridCenter(){return this.Lh}set gridCenter(t){this.Lh.copy(t)}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}setGridInfoFromCollideMap(t){this.Ih=t.gridCellWidth,this.Th=t.gridCellHeight,this.Lh.set(t.gridCenterX,t.gridCenterY)}get inputWidth(){return this.Mn}set inputWidth(t){this.Mn=t,this.yn&&(this.yn.style.width=this.Mn/this.rn+"px")}get inputHeight(){return this._n}set inputHeight(t){this._n=t,this.yn&&(this.yn.style.height=this._n/this.rn+"px")}get viewScale(){return this.rn}set viewScale(t){this.rn=t,this.yn&&(this.yn.style.width=this.Mn/this.rn+"px",this.yn.style.height=this._n/this.rn+"px"),this.Vn&&(this.Vn.scale.setScalar(this.rn),o.w.updateRawObject3DWorldMatrixRecursively(this.Vn),this.transform.enqueueRenderAttachedObject3D(this.Vn))}}},7111:(t,i,s)=>{s.d(i,{n:()=>a});var e=s(6120),h=s(4532),r=s(3674),n=s(8788),o=s(6868),l=s(3379);class a extends r.w{constructor(){super(...arguments),this.Xr=new Map,this.Yr=16,this.Kr=1,this.Jr=1,this.Qr=16,this.Zr=16,this.tn=1.001,this.sn=null,this.en=!0,this.rn=.1,this.nn=n.r.Pixelated,this.on=()=>{this.Xr.forEach(((t,i)=>{t.filter.copy(this.Ui)}))},this.Ui=new l.c(this.on),this.Hr=[],this.Wr=!1}start(){this.Wr=!0;const t=this.Hr;for(let i=0;i<t.length;++i)t[i]();this.Hr.length=0}ln(){this.Xr.forEach(((t,i)=>{const s=this.cn(i)*this.Yr*this.Kr,e=this.un(i)*this.Yr*this.Jr;t.gameObject.transform.localPosition.set(s,e,0)}))}cn(t){return parseInt(t.substring(0,t.indexOf("_")))}un(t){return parseInt(t.substring(t.indexOf("_")+1))}an(t,i){return`${t}_${i}`}dn(t,i,s,h){const r=s-t*this.Yr+this.Yr/2,n=h-i*this.Yr+this.Yr/2;return new e.F(r,n)}fn(t,i){const s=this.an(t,i);let e=this.Xr.get(s);return void 0===e&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("css_tilemap_renderer_"+t+"_"+i,new h.P(t*this.Yr*this.Kr,i*this.Yr*this.Jr,0),void 0,(new h.P).setScalar(this.tn)).withComponent(o.N,(t=>{e=t,this.sn&&(t.imageSources=this.sn),t.gridCellWidth=this.Kr,t.gridCellHeight=this.Jr,t.tileResolutionX=this.Qr,t.tileResolutionY=this.Zr,t.rowCount=this.Yr,t.columnCount=this.Yr,t.pointerEvents=this.en,t.viewScale=this.rn,t.filter.copy(this.Ui)}))),this.Xr.set(s,e)),e}gn(t,i){const s=this.an(t,i),e=this.Xr.get(s);return void 0===e?null:e}drawTile(t,i,s,e){if(!this.Wr)return void this.Hr.push((()=>{this.drawTile(t,i,s,e)}));const h=Math.floor((t+this.Yr/2)/this.Yr),r=Math.floor((i+this.Yr/2)/this.Yr),n=this.fn(h,r),o=this.dn(h,r,t,i),l=this.chunkSize%2==0?0:-.5,a=this.chunkSize%2==0?0:.5;n.drawTile(o.x+l,this.Yr-o.y-1+a,s,e)}drawTileFromTwoDimensionalArray(t,i,s){if(this.Wr)for(let e=0;e<t.length;e++)for(let h=0;h<t[e].length;h++)null!==t[e][h]&&this.drawTile(h+i,t.length-e+s-1,t[e][h].i,t[e][h].a);else this.Hr.push((()=>{this.drawTileFromTwoDimensionalArray(t,i,s)}))}clearTile(t,i){if(!this.Wr)return void this.Hr.push((()=>{this.clearTile(t,i)}));const s=Math.floor((t+this.Yr/2)/this.Yr),e=Math.floor((i+this.Yr/2)/this.Yr),h=this.gn(s,e);if(null===h)return;const r=this.dn(s,e,t,i),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.clearTile(r.x+n,this.Yr-r.y-1+o)}get chunkSize(){return this.Yr}set chunkSize(t){this.Yr=t,this.ln(),this.Xr.forEach(((t,i)=>{t.rowCount=this.Yr,t.columnCount=this.Yr}))}set imageSources(t){this.Wr?(this.sn=t,this.Xr.forEach(((i,s)=>{i.imageSources=t}))):this.Hr.push((()=>{this.imageSources=t}))}get pointerEvents(){return this.en}set pointerEvents(t){this.en=t,this.Xr.forEach(((i,s)=>{i.pointerEvents=t}))}get gridCellWidth(){return this.Kr}set gridCellWidth(t){this.Kr!==t&&(this.Kr=t,this.ln(),this.Xr.forEach(((t,i)=>{t.gridCellWidth=this.Kr})))}get gridCellHeight(){return this.Jr}set gridCellHeight(t){this.Jr!==t&&(this.Jr=t,this.ln(),this.Xr.forEach(((t,i)=>{t.gridCellHeight=this.Jr})))}get tileResolutionX(){return this.Qr}set tileResolutionX(t){this.Qr!==t&&(this.Qr=t,this.Xr.forEach(((t,i)=>{t.tileResolutionX=this.Qr})))}get tileResolutionY(){return this.Zr}set tileResolutionY(t){this.Zr!==t&&(this.Zr=t,this.Xr.forEach(((t,i)=>{t.tileResolutionY=this.Zr})))}get tilemapScale(){return this.tn}set tilemapScale(t){this.tn!==t&&(this.tn=t,this.Xr.forEach(((t,i)=>{t.gameObject.transform.localScale.setScalar(this.tn)})))}get gridCenter(){const t=this.Yr%2==1?0:this.Kr/2,i=this.Yr%2==1?0:this.Jr/2;return new e.F(this.transform.localPosition.x+t,this.transform.localPosition.y+i)}get gridCenterX(){const t=this.Yr%2==1?0:this.Kr/2;return this.transform.localPosition.x+t}get gridCenterY(){const t=this.Yr%2==1?0:this.Jr/2;return this.transform.localPosition.y+t}get viewScale(){return this.rn}set viewScale(t){this.rn=t,this.Xr.forEach(((t,i)=>{t.viewScale=this.rn}))}get filter(){return this.Ui}get imageRenderingMode(){return this.nn}set imageRenderingMode(t){this.nn=t,this.Xr.forEach(((i,s)=>{i.imageRenderingMode=t}))}}},4286:(t,i,s)=>{s.d(i,{h:()=>r});var e=s(3674),h=s(4483);class r extends e.w{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[h.$],this.nl=null,this.ia={},this.sa=null,this.ea=null,this.na=0,this.ra=!1,this.ha=2,this.oa=0,this.aa=null}awake(){this.nl=this.gameObject.getComponent(h.$),null!==this.aa&&(this.playAnimation(this.aa),this.aa=null)}update(){null!==this.nl&&this.ra&&(this.oa+=this.engine.time.deltaTime,this.oa>=this.ha&&(this.oa=0,this.na++,this.na>=this.ea.length&&(this.na=0),this.nl.imageIndex=this.ea[this.na]))}playAnimation(t){null!==this.nl?this.sa!==t&&(this.sa=t,this.ea=this.ia[t],this.na=0,this.nl.imageIndex=this.ia[t][0],this.ra=!0):this.aa=t}stopAnimation(){this.ra=!1,this.aa=null}addAnimation(t,i){0!==i.length?this.ia[t]=i:console.warn(`Animation "${t}" has no frames.`)}get frameDuration(){return this.ha}set frameDuration(t){this.ha=t}}},251:(t,i,s)=>{s.d(i,{N:()=>h});var e=s(3514);class h extends e.C{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.rl=-100}update(){this.transform.localPosition.z=this.engine.cameraContainer.camera.transform.position.z+this.rl}get offset(){return this.rl}set offset(t){this.rl=t}}},6868:(t,i,s)=>{s.d(i,{I:()=>o,N:()=>l});var e=s(6120),h=s(4627),r=s(6924),n=s(8788);class o{constructor(t,i=1,s=1){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);this.uc=t,this.Sa=s,this.pa=i}get htmlImageElement(){return this.uc}get columnCount(){return this.pa}get rowCount(){return this.Sa}}class l extends r.Y{constructor(){super(...arguments),this.pa=10,this.Sa=10,this.Kr=1,this.Jr=1,this.Qr=16,this.Zr=16,this.sn=null,this.nn=n.r.Pixelated,this.Hr=[]}renderInitialize(){this.dc();const t=this.Hr;for(let i=0;i<t.length;++i)t[i]();this.Hr.length=0}updateCenterOffset(t){if(!this.css3DObject)return;const i=this.pa*this.Kr,s=this.Sa*this.Jr;this.css3DObject.position.set(i*this.centerOffset.x,s*this.centerOffset.y,0),t&&(h.w.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const i=this.viewScale,s=this.htmlElement,e=this.pa*this.Kr,r=this.Sa*this.Jr;s.style.width=e/i+"px",s.style.height=r/i+"px",this.css3DObject.scale.set(i,i,i),t&&(h.w.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}dc(){const t=this.pa*this.Kr,i=this.Sa*this.Jr,s=this.pa*this.Qr,e=this.Sa*this.Zr;this.htmlElement=document.createElement("canvas"),this.htmlElement.width=s,this.htmlElement.height=e,this.htmlElement.style.imageRendering=this.nn,this.htmlElement.style.width=t/this.viewScale+"px",this.htmlElement.style.height=i/this.viewScale+"px";const r=this.initializeBaseComponents(!1);h.w.updateRawObject3DWorldMatrixRecursively(r),this.transform.enqueueRenderAttachedObject3D(r)}drawTile(t,i,s,e){if(!this.readyToDraw)return void this.Hr.push((()=>this.drawTile(t,i,s,e)));const h=this.htmlElement.getContext("2d"),r=this.sn[s];if(1===r.rowCount&&1===r.columnCount)h.drawImage(r.htmlImageElement,0,0,this.Qr,this.Zr,t*this.Qr,i*this.Zr,this.Qr,this.Zr);else{if(void 0===e)throw new Error("Atlas index is required.");{const s=Math.floor(e/r.columnCount),n=e%r.columnCount,o=r.htmlImageElement.width/r.columnCount,l=r.htmlImageElement.height/r.rowCount;h.drawImage(r.htmlImageElement,n*o,s*l,o,l,t*this.Qr,i*this.Zr,this.Qr,this.Zr)}}}drawTileFromTwoDimensionalArray(t,i,s){if(!this.readyToDraw)return void this.Hr.push((()=>this.drawTileFromTwoDimensionalArray(t,i,s)));const e=this.htmlElement.getContext("2d");for(let h=0;h<t.length;h++){const r=t[h];for(let t=0;t<r.length;t++){const n=r[t];if(null===n)continue;const o=this.sn[n.i];if(1===o.rowCount&&1===o.columnCount)e.drawImage(o.htmlImageElement,0,0,this.Qr,this.Zr,t*this.Qr+i*this.Qr,h*this.Zr+s*this.Zr,this.Qr,this.Zr);else{if(void 0===n.a)throw new Error("Atlas index is required.");{const r=n.a%o.columnCount,l=Math.floor(n.a/o.columnCount),a=o.htmlImageElement.width/o.columnCount,d=o.htmlImageElement.height/o.rowCount;e.drawImage(o.htmlImageElement,r*a,l*d,a,d,t*this.Qr+i*this.Qr,h*this.Zr+s*this.Zr,this.Qr,this.Zr)}}}}}clearTile(t,i){if(!this.readyToDraw)return void this.Hr.push((()=>this.clearTile(t,i)));this.htmlElement.getContext("2d").clearRect(t*this.Qr,i*this.Zr,this.Qr,this.Zr)}set imageSources(t){if(this.readyToDraw){this.sn=t;for(let i=0;i<t.length;++i)if(!t[i].htmlImageElement.complete)throw new Error(`Image ${t[i].htmlImageElement.src} is not loaded.`)}else this.Hr.push((()=>this.imageSources=t))}get columnCount(){return this.pa}set columnCount(t){if(this.pa=t,this.htmlElement){const t=this.pa*this.Kr,i=this.pa*this.Qr;this.htmlElement.width=i,this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get rowCount(){return this.Sa}set rowCount(t){if(this.Sa=t,this.htmlElement){const t=this.Sa*this.Jr,i=this.Sa*this.Zr;this.htmlElement.height=i,this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellWidth(){return this.Kr}set gridCellWidth(t){if(this.Kr=t,this.htmlElement){const t=this.pa*this.Kr;this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellHeight(){return this.Jr}set gridCellHeight(t){if(this.Jr=t,this.htmlElement){const t=this.Sa*this.Jr;this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get tileResolutionX(){return this.Qr}set tileResolutionX(t){if(this.Qr=t,this.htmlElement){const t=this.pa*this.Qr;this.htmlElement.width=t}}get tileResolutionY(){return this.Zr}set tileResolutionY(t){if(this.Zr=t,this.htmlElement){const t=this.Sa*this.Zr;this.htmlElement.height=t}}get gridCenter(){const t=this.columnCount%2==1?0:this.Kr/2,i=this.rowCount%2==1?0:this.Jr/2;return new e.F(this.transform.position.x+t,this.transform.position.y+i)}get gridCenterX(){return this.transform.position.x+(this.columnCount%2==1?0:this.Kr/2)}get gridCenterY(){return this.transform.position.y+(this.rowCount%2==1?0:this.Jr/2)}get imageRenderingMode(){return this.nn}set imageRenderingMode(t){this.nn=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.nn)}}},3514:(t,i,s)=>{s.d(i,{C:()=>h});var e=s(3674);class h extends e.w{}},9020:(t,i,s)=>{s.d(i,{$:()=>h});var e=s(3514);class h extends e.C{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.rl=0,this.Za=!0}start(){this.update(),this.Za&&this.destroy()}update(){const t=this.transform.position;t.z=-t.y+this.rl}get offset(){return this.rl}set offset(t){this.rl=t}get runOnce(){return this.Za}set runOnce(t){this.Za=t}}}}]);